{
  "version": 3,
  "sources": ["../../server/test-utils/htmlUtils.ts"],
  "sourcesContent": ["import { createHash } from 'crypto';\nimport fs from 'fs';\nimport path from 'path';\n\n/**\n * Normalises HTML content for comparison by:\n * - Removing extra whitespace\n * - Normalising line endings\n * - Removing dynamic content that might differ between runs\n */\nexport const normalizeHtml = (html: string): string => {\n  return html\n    .replace(/\\r\\n/g, '\\n') // Normalise line endings\n    .replace(/>\\s+</g, '><') // Remove whitespace between tags\n    .trim();\n};\n\n/**\n * Validates an HTML response against a snapshot file.\n * If UPDATE_HTML_SNAPSHOTS env var is set, updates the snapshot instead of comparing.\n */\nexport const validateHtmlAgainstSnapshot = (response: string, snapshotName: string) => {\n  const normalizedResponse = normalizeHtml(response);\n  const responseHash = createHash('sha256').update(normalizedResponse).digest('hex');\n\n  const snapshotPath = path.resolve(__dirname, snapshotName);\n\n  if (!fs.existsSync(snapshotPath) && !process.env.UPDATE_HTML_SNAPSHOTS) {\n    throw new Error(`Snapshot file does not exist: ${snapshotPath}. Run with UPDATE_HTML_SNAPSHOTS=1 to create it.`);\n  }\n\n  if (fs.existsSync(snapshotPath)) {\n    const referenceFile = fs.readFileSync(snapshotPath, 'utf-8');\n    const normalizedReference = normalizeHtml(referenceFile);\n    const referenceHash = createHash('sha256').update(normalizedReference).digest('hex');\n\n    try {\n      expect(responseHash).toEqual(referenceHash);\n    } catch (error) {\n      if (process.env.UPDATE_HTML_SNAPSHOTS) {\n        fs.writeFileSync(snapshotPath, response);\n      } else {\n        throw error;\n      }\n    }\n  } else if (process.env.UPDATE_HTML_SNAPSHOTS) {\n    // Create the directory if it doesn't exist\n    const dir = path.dirname(snapshotPath);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n    fs.writeFileSync(snapshotPath, response);\n  }\n};\n\n/**\n * Basic HTML validation checks\n */\nexport const validateHtmlStructure = (html: string) => {\n  // Check for basic HTML structure\n  expect(html).toBeTruthy();\n  expect(typeof html).toBe('string');\n\n  // Check that HTML contains basic accessibility elements\n  if (html.includes('<section')) {\n    expect(html).toMatch(/aria-labelledby=[\"'][^\"']+[\"']/);\n  }\n\n  return true;\n};\n\n/**\n * Checks if HTML contains specific content\n */\nexport const expectHtmlToContain = (html: string, ...contents: string[]) => {\n  contents.forEach(content => {\n    expect(html).toContain(content);\n  });\n};\n\n/**\n * Checks if HTML does not contain specific content\n */\nexport const expectHtmlNotToContain = (html: string, ...contents: string[]) => {\n  contents.forEach(content => {\n    expect(html).not.toContain(content);\n  });\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAA2B;AAC3B,gBAAe;AACf,kBAAiB;AAQV,MAAM,gBAAgB,CAAC,SAAyB;AACrD,SAAO,KACJ,QAAQ,SAAS,IAAI,EACrB,QAAQ,UAAU,IAAI,EACtB,KAAK;AACV;AAMO,MAAM,8BAA8B,CAAC,UAAkB,iBAAyB;AACrF,QAAM,qBAAqB,cAAc,QAAQ;AACjD,QAAM,mBAAe,0BAAW,QAAQ,EAAE,OAAO,kBAAkB,EAAE,OAAO,KAAK;AAEjF,QAAM,eAAe,YAAAA,QAAK,QAAQ,WAAW,YAAY;AAEzD,MAAI,CAAC,UAAAC,QAAG,WAAW,YAAY,KAAK,CAAC,QAAQ,IAAI,uBAAuB;AACtE,UAAM,IAAI,MAAM,iCAAiC,YAAY,kDAAkD;AAAA,EACjH;AAEA,MAAI,UAAAA,QAAG,WAAW,YAAY,GAAG;AAC/B,UAAM,gBAAgB,UAAAA,QAAG,aAAa,cAAc,OAAO;AAC3D,UAAM,sBAAsB,cAAc,aAAa;AACvD,UAAM,oBAAgB,0BAAW,QAAQ,EAAE,OAAO,mBAAmB,EAAE,OAAO,KAAK;AAEnF,QAAI;AACF,aAAO,YAAY,EAAE,QAAQ,aAAa;AAAA,IAC5C,SAAS,OAAO;AACd,UAAI,QAAQ,IAAI,uBAAuB;AACrC,kBAAAA,QAAG,cAAc,cAAc,QAAQ;AAAA,MACzC,OAAO;AACL,cAAM;AAAA,MACR;AAAA,IACF;AAAA,EACF,WAAW,QAAQ,IAAI,uBAAuB;AAE5C,UAAM,MAAM,YAAAD,QAAK,QAAQ,YAAY;AACrC,QAAI,CAAC,UAAAC,QAAG,WAAW,GAAG,GAAG;AACvB,gBAAAA,QAAG,UAAU,KAAK,EAAE,WAAW,KAAK,CAAC;AAAA,IACvC;AACA,cAAAA,QAAG,cAAc,cAAc,QAAQ;AAAA,EACzC;AACF;AAKO,MAAM,wBAAwB,CAAC,SAAiB;AAErD,SAAO,IAAI,EAAE,WAAW;AACxB,SAAO,OAAO,IAAI,EAAE,KAAK,QAAQ;AAGjC,MAAI,KAAK,SAAS,UAAU,GAAG;AAC7B,WAAO,IAAI,EAAE,QAAQ,gCAAgC;AAAA,EACvD;AAEA,SAAO;AACT;AAKO,MAAM,sBAAsB,CAAC,SAAiB,aAAuB;AAC1E,WAAS,QAAQ,aAAW;AAC1B,WAAO,IAAI,EAAE,UAAU,OAAO;AAAA,EAChC,CAAC;AACH;AAKO,MAAM,yBAAyB,CAAC,SAAiB,aAAuB;AAC7E,WAAS,QAAQ,aAAW;AAC1B,WAAO,IAAI,EAAE,IAAI,UAAU,OAAO;AAAA,EACpC,CAAC;AACH;",
  "names": ["path", "fs"]
}
