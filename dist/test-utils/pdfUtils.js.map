{
  "version": 3,
  "sources": ["../../server/test-utils/pdfUtils.ts"],
  "sourcesContent": ["import { createHash } from 'crypto';\nimport fs from 'fs';\nimport path from 'path';\n\nexport const stripPdfMetadata = (pdfBuffer: Buffer) => {\n  const pdfText = pdfBuffer.toString('latin1');\n  return pdfText\n    .replace(/\\/CreationDate\\s+\\(D:[^)]+\\)/g, '')\n    .replace(/\\/ModDate\\s+\\(D:[^)]+\\)/g, '')\n    .replace(/\\/ID\\s+\\[\\s*<[^>]+>\\s*<[^>]+>\\s*\\]/gs, '')\n    .replace(/\\/Producer\\s+\\([^)]+\\)/g, '')\n    .replace(/\\/Creator\\s+\\([^)]+\\)/g, '')\n    .replace(/\\/Title\\s+\\([^)]+\\)/g, '')\n    .replace(/\\/Author\\s+\\([^)]+\\)/g, '')\n    .replace(/\\/Subject\\s+\\([^)]+\\)/g, '')\n    .replace(/\\/Keywords\\s+\\([^)]+\\)/g, '');\n};\n\nexport const validateResponseAgainstSnapshot = (response: Buffer, snapshotName: string) => {\n  const responseHash = createHash('sha256').update(stripPdfMetadata(response)).digest('hex');\n\n  // Use process.cwd() to get the project root directory\n  const projectRoot = process.cwd();\n  const snapshotPath = path.join(projectRoot, snapshotName);\n\n  const referenceFile = fs.readFileSync(snapshotPath);\n  const referenceHash = createHash('sha256').update(stripPdfMetadata(referenceFile)).digest('hex');\n\n  try {\n    expect(responseHash).toEqual(referenceHash);\n  } catch (error) {\n    if (process.env.UPDATE_PDF_SNAPSHOTS) {\n      fs.writeFileSync(snapshotPath, response);\n    } else {\n      throw error;\n    }\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAA2B;AAC3B,gBAAe;AACf,kBAAiB;AAEV,MAAM,mBAAmB,CAAC,cAAsB;AACrD,QAAM,UAAU,UAAU,SAAS,QAAQ;AAC3C,SAAO,QACJ,QAAQ,iCAAiC,EAAE,EAC3C,QAAQ,4BAA4B,EAAE,EACtC,QAAQ,wCAAwC,EAAE,EAClD,QAAQ,2BAA2B,EAAE,EACrC,QAAQ,0BAA0B,EAAE,EACpC,QAAQ,wBAAwB,EAAE,EAClC,QAAQ,yBAAyB,EAAE,EACnC,QAAQ,0BAA0B,EAAE,EACpC,QAAQ,2BAA2B,EAAE;AAC1C;AAEO,MAAM,kCAAkC,CAAC,UAAkB,iBAAyB;AACzF,QAAM,mBAAe,0BAAW,QAAQ,EAAE,OAAO,iBAAiB,QAAQ,CAAC,EAAE,OAAO,KAAK;AAGzF,QAAM,cAAc,QAAQ,IAAI;AAChC,QAAM,eAAe,YAAAA,QAAK,KAAK,aAAa,YAAY;AAExD,QAAM,gBAAgB,UAAAC,QAAG,aAAa,YAAY;AAClD,QAAM,oBAAgB,0BAAW,QAAQ,EAAE,OAAO,iBAAiB,aAAa,CAAC,EAAE,OAAO,KAAK;AAE/F,MAAI;AACF,WAAO,YAAY,EAAE,QAAQ,aAAa;AAAA,EAC5C,SAAS,OAAO;AACd,QAAI,QAAQ,IAAI,sBAAsB;AACpC,gBAAAA,QAAG,cAAc,cAAc,QAAQ;AAAA,IACzC,OAAO;AACL,YAAM;AAAA,IACR;AAAA,EACF;AACF;",
  "names": ["path", "fs"]
}
