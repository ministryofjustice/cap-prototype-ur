{
  "version": 3,
  "sources": ["../../server/utils/nunjucksSetup.ts"],
  "sourcesContent": ["import fs from 'fs';\nimport path from 'path';\n\nimport express from 'express';\nimport i18n from 'i18n';\nimport { configure as configureNunjucks } from 'nunjucks';\n\nimport config from '../config';\nimport cookieNames from '../constants/cookieNames';\nimport formFields from '../constants/formFields';\nimport paths from '../constants/paths';\nimport logger from '../logging/logger';\n\nimport getAssetPath from './getAssetPath';\nimport errorSummaryList from './nunjucksHelpers/errorSummaryList';\nimport findError from './nunjucksHelpers/findError';\nimport urlize from './nunjucksHelpers/urlize';\n\nconst nunjucksSetup = (app: express.Express): void => {\n  app.set('view engine', 'njk');\n\n  let assetManifest: Record<string, string> = {};\n\n  try {\n    const assetMetadataPath = getAssetPath('manifest.json');\n    assetManifest = JSON.parse(fs.readFileSync(assetMetadataPath, 'utf8'));\n  } catch (e) {\n    if (process.env.NODE_ENV !== 'test') {\n      logger.error(e, 'Could not read asset manifest file');\n    }\n  }\n\n  const njkEnv = configureNunjucks([path.join(__dirname, '../views'), 'node_modules/govuk-frontend/dist/'], {\n    autoescape: true,\n    express: app,\n  });\n\n  njkEnv.addFilter('assetMap', (url: string) => assetManifest[url] || url);\n  njkEnv.addGlobal('feedbackUrl', config.feedbackUrl);\n  njkEnv.addGlobal('contactEmail', config.contactEmail);\n  njkEnv.addGlobal(\n    'previewEnd',\n    config.previewEnd.toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' }),\n  );\n  njkEnv.addGlobal('paths', paths);\n  njkEnv.addGlobal('formFields', formFields);\n  njkEnv.addGlobal('cookieNames', cookieNames);\n  njkEnv.addGlobal('__', i18n.__);\n  njkEnv.addGlobal('getLocale', () => i18n.getLocale);\n  njkEnv.addFilter('findError', findError);\n  njkEnv.addFilter('errorSummaryList', errorSummaryList);\n  njkEnv.addFilter('customUrlize', urlize);\n};\n\nexport default nunjucksSetup;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAe;AACf,kBAAiB;AAGjB,kBAAiB;AACjB,sBAA+C;AAE/C,oBAAmB;AACnB,yBAAwB;AACxB,wBAAuB;AACvB,mBAAkB;AAClB,oBAAmB;AAEnB,0BAAyB;AACzB,8BAA6B;AAC7B,uBAAsB;AACtB,oBAAmB;AAEnB,MAAM,gBAAgB,CAAC,QAA+B;AACpD,MAAI,IAAI,eAAe,KAAK;AAE5B,MAAI,gBAAwC,CAAC;AAE7C,MAAI;AACF,UAAM,wBAAoB,oBAAAA,SAAa,eAAe;AACtD,oBAAgB,KAAK,MAAM,UAAAC,QAAG,aAAa,mBAAmB,MAAM,CAAC;AAAA,EACvE,SAAS,GAAG;AACV,QAAI,QAAQ,IAAI,aAAa,QAAQ;AACnC,oBAAAC,QAAO,MAAM,GAAG,oCAAoC;AAAA,IACtD;AAAA,EACF;AAEA,QAAM,aAAS,gBAAAC,WAAkB,CAAC,YAAAC,QAAK,KAAK,WAAW,UAAU,GAAG,mCAAmC,GAAG;AAAA,IACxG,YAAY;AAAA,IACZ,SAAS;AAAA,EACX,CAAC;AAED,SAAO,UAAU,YAAY,CAAC,QAAgB,cAAc,GAAG,KAAK,GAAG;AACvE,SAAO,UAAU,eAAe,cAAAC,QAAO,WAAW;AAClD,SAAO,UAAU,gBAAgB,cAAAA,QAAO,YAAY;AACpD,SAAO;AAAA,IACL;AAAA,IACA,cAAAA,QAAO,WAAW,mBAAmB,SAAS,EAAE,KAAK,WAAW,OAAO,QAAQ,MAAM,UAAU,CAAC;AAAA,EAClG;AACA,SAAO,UAAU,SAAS,aAAAC,OAAK;AAC/B,SAAO,UAAU,cAAc,kBAAAC,OAAU;AACzC,SAAO,UAAU,eAAe,mBAAAC,OAAW;AAC3C,SAAO,UAAU,MAAM,YAAAC,QAAK,EAAE;AAC9B,SAAO,UAAU,aAAa,MAAM,YAAAA,QAAK,SAAS;AAClD,SAAO,UAAU,aAAa,iBAAAC,OAAS;AACvC,SAAO,UAAU,oBAAoB,wBAAAC,OAAgB;AACrD,SAAO,UAAU,gBAAgB,cAAAC,OAAM;AACzC;AAEA,IAAO,wBAAQ;",
  "names": ["getAssetPath", "fs", "logger", "configureNunjucks", "path", "config", "paths", "formFields", "cookieNames", "i18n", "findError", "errorSummaryList", "urlize"]
}
