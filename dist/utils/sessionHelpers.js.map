{
  "version": 3,
  "sources": ["../../server/utils/sessionHelpers.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Request } from 'express';\nimport { SessionData } from 'express-session';\n\nimport { CAPSession } from '../@types/session';\n\nimport { formatListOfStrings } from './formValueUtils';\nimport { getSessionValue } from './perChildSession';\nimport { validateRedirectUrl } from './redirectValidator';\n\nexport const formattedChildrenNames = (request: Request) =>\n  formatListOfStrings(request.session.namesOfChildren, request);\n\n// Helper to get the 'where' value from mostlyLive, handling both old and new formats\nconst getMostlyLiveWhere = (mostlyLive: any): string | undefined => {\n  if (!mostlyLive) return undefined;\n  // New PerChildAnswer format\n  if (mostlyLive.default?.where) return mostlyLive.default.where;\n  // Legacy format\n  return mostlyLive.where;\n};\n\nexport const parentMostlyLivedWith = (session: Partial<CAPSession>) => {\n  const livingAndVisiting = getSessionValue<any>(session, 'livingAndVisiting');\n  const where = getMostlyLiveWhere(livingAndVisiting?.mostlyLive);\n  return where === 'withInitial' ? session.initialAdultName : session.secondaryAdultName;\n};\n\nexport const parentNotMostlyLivedWith = (session: Partial<CAPSession>) => {\n  const livingAndVisiting = getSessionValue<any>(session, 'livingAndVisiting');\n  const where = getMostlyLiveWhere(livingAndVisiting?.mostlyLive);\n  return where === 'withInitial' ? session.secondaryAdultName : session.initialAdultName;\n};\n\nexport const mostlyLiveComplete = (session: Partial<CAPSession>) => {\n  const livingAndVisiting = getSessionValue<any>(session, 'livingAndVisiting');\n  if (!livingAndVisiting?.mostlyLive) return false;\n\n  const { mostlyLive, overnightVisits, daytimeVisits, whichSchedule } = livingAndVisiting;\n  const where = getMostlyLiveWhere(mostlyLive);\n\n  if (where === 'other') {\n    return true;\n  }\n  if (where === 'split') {\n    return !!whichSchedule;\n  }\n\n  const overnightComplete =\n    overnightVisits?.willHappen !== undefined && (!overnightVisits.willHappen || !!overnightVisits.whichDays);\n  const daytimeVisitsComplete =\n    daytimeVisits?.willHappen !== undefined && (!daytimeVisits.willHappen || !!daytimeVisits.whichDays);\n  return overnightComplete && daytimeVisitsComplete;\n};\n\nexport const getBetweenHouseholdsComplete = (session: Partial<CAPSession>) => {\n  const handoverAndHolidays = getSessionValue<any>(session, 'handoverAndHolidays');\n  return !!handoverAndHolidays?.getBetweenHouseholds;\n};\n\nexport const whereHandoverComplete = (session: Partial<CAPSession>) => {\n  const handoverAndHolidays = getSessionValue<any>(session, 'handoverAndHolidays');\n  return !!handoverAndHolidays?.whereHandover;\n};\n\nexport const willChangeDuringSchoolHolidaysComplete = (session: Partial<CAPSession>) => {\n  const handoverAndHolidays = getSessionValue<any>(session, 'handoverAndHolidays');\n  if (!handoverAndHolidays?.willChangeDuringSchoolHolidays) return false;\n\n  return !(\n    handoverAndHolidays.willChangeDuringSchoolHolidays.willChange && !handoverAndHolidays.howChangeDuringSchoolHolidays\n  );\n};\n\nexport const itemsForChangeoverComplete = (session: Partial<CAPSession>) => {\n  const handoverAndHolidays = getSessionValue<any>(session, 'handoverAndHolidays');\n  return !!handoverAndHolidays?.itemsForChangeover;\n};\n\nexport const whatWillHappenComplete = (session: Partial<CAPSession>) => {\n  const specialDays = getSessionValue<any>(session, 'specialDays');\n  return !!specialDays?.whatWillHappen;\n};\n\nexport const whatOtherThingsMatterComplete = (session: Partial<CAPSession>) => {\n  const otherThings = getSessionValue<any>(session, 'otherThings');\n  return !!otherThings?.whatOtherThingsMatter;\n};\n\nexport const planLastMinuteChangesComplete = (session: Partial<CAPSession>) => {\n  const decisionMaking = getSessionValue<any>(session, 'decisionMaking');\n  return !!decisionMaking?.planLastMinuteChanges;\n};\n\nexport const planLongTermNoticeComplete = (session: Partial<CAPSession>) => {\n  const decisionMaking = getSessionValue<any>(session, 'decisionMaking');\n  return !!decisionMaking?.planLongTermNotice;\n};\n\nexport const planReviewComplete = (session: Partial<CAPSession>) => {\n  const decisionMaking = getSessionValue<any>(session, 'decisionMaking');\n  return !!decisionMaking?.planReview;\n};\n\nexport const getBackUrl = (session: Partial<SessionData>, defaultUrl: string) => {\n  if (!session.previousPage) {\n    return defaultUrl;\n  }\n  return validateRedirectUrl(session.previousPage, defaultUrl);\n};\n\nexport const getRedirectUrlAfterFormSubmit = (session: Partial<SessionData>, defaultUrl: string) => {\n  // If the user came directly from check answers page, redirect back there\n  const previousPage = session.previousPage;\n  if (previousPage === '/check-your-answers') {\n    return validateRedirectUrl(previousPage, defaultUrl);\n  }\n  // defaultUrl is already from paths enum, so it's safe\n  return defaultUrl;\n};\n"],
  "mappings": "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",
  "names": []
}
