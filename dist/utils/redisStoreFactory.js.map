{
  "version": 3,
  "sources": ["../../server/utils/redisStoreFactory.ts"],
  "sourcesContent": ["import { Store } from 'express-rate-limit';\nimport { RedisStore } from 'rate-limit-redis';\n\nimport config from '../config';\nimport createCacheClient from '../data/cacheClient';\n\ntype CacheClient = ReturnType<typeof createCacheClient>;\nlet redisClient: CacheClient | undefined;\n\nif (config.cache.enabled) {\n    redisClient = createCacheClient();\n    redisClient.connect().catch((err: Error) => console.error(`Error connecting to cache`, err)); \n}\n\n/**\n * Creates a new, unique RedisStore instance with a specific prefix.\n * @param prefix The unique prefix for the Redis keys (e.g., 'general:', 'download:')\n * @returns A new RedisStore instance or undefined if cache is disabled.\n */\nconst createRedisStore = (prefix: string): Store | undefined => {\n    if (config.cache.enabled && redisClient) {\n        return new RedisStore({ \n            sendCommand: (...args: string[]) => redisClient!.sendCommand(args),\n            prefix: prefix, // Ensures unique keys for this specific limiter\n        });\n    }\n    // Rate-limit will default to using MemoryStore if undefined is returned here.\n    return undefined; \n};\n\nexport default createRedisStore"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,8BAA2B;AAE3B,oBAAmB;AACnB,yBAA8B;AAG9B,IAAI;AAEJ,IAAI,cAAAA,QAAO,MAAM,SAAS;AACtB,oBAAc,mBAAAC,SAAkB;AAChC,cAAY,QAAQ,EAAE,MAAM,CAAC,QAAe,QAAQ,MAAM,6BAA6B,GAAG,CAAC;AAC/F;AAOA,MAAM,mBAAmB,CAAC,WAAsC;AAC5D,MAAI,cAAAD,QAAO,MAAM,WAAW,aAAa;AACrC,WAAO,IAAI,mCAAW;AAAA,MAClB,aAAa,IAAI,SAAmB,YAAa,YAAY,IAAI;AAAA,MACjE;AAAA;AAAA,IACJ,CAAC;AAAA,EACL;AAEA,SAAO;AACX;AAEA,IAAO,4BAAQ;",
  "names": ["config", "createCacheClient"]
}
