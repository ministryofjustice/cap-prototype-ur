{
  "version": 3,
  "sources": ["../../server/utils/perChildSession.ts"],
  "sourcesContent": ["/**\n * Utility functions for managing per-child session data\n * Abstracts Design 1 (inline per-child) vs Design 2 (task list level) logic\n */\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport { CAPSession, ChildPlan, PerChildAnswer } from '../@types/session';\n\n// Type for session that may or may not be fully initialized\ntype SessionLike = Partial<CAPSession>;\n\n/**\n * Check if the per-child PoC is enabled for this session\n * Returns true only if the user selected the PoC version in the UR toggle\n */\nexport function isPerChildPoCEnabled(session: SessionLike): boolean {\n  return session.usePerChildPoC === true;\n}\n\n/**\n * Check if the session is using Design 2 (task list level per-child)\n */\nexport function isDesign2(session: SessionLike): boolean {\n  return session.perChildDesignMode === 'design2';\n}\n\n/**\n * Check if the session is using Design 3 (answer once + \"Or specify per child\" option)\n */\nexport function isDesign3(session: SessionLike): boolean {\n  return session.perChildDesignMode === 'design3';\n}\n\n/**\n * Check if the session is using Design 4 (inline per-child with checkboxes instead of dropdown)\n */\nexport function isDesign4(session: SessionLike): boolean {\n  return session.perChildDesignMode === 'design4';\n}\n\n/**\n * Check if the session is using inline per-child mode (Design 1)\n * This is the mode where users can add different answers for different children on the same page\n * using the \"Add answer for a specific child\" button\n */\nexport function isAnswerPerChild(session: SessionLike): boolean {\n  return !isDesign2(session);\n}\n\n/**\n * Get the current child index (for Design 2)\n */\nexport function getCurrentChildIndex(session: SessionLike): number {\n  return session.currentChildIndex ?? 0;\n}\n\n/**\n * Get the current child plan (for Design 2)\n */\nexport function getCurrentChildPlan(session: SessionLike): ChildPlan | undefined {\n  if (!isDesign2(session)) {\n    return undefined;\n  }\n\n  const currentIndex = getCurrentChildIndex(session);\n  return session.childPlans?.find((p) => p.childIndex === currentIndex);\n}\n\n/**\n * Get a value from session, abstracting Design 1 vs Design 2\n * For Design 2, gets from current child's plan\n * For Design 1, gets from main session\n */\nexport function getSessionValue<T>(\n  session: SessionLike,\n  section: keyof ChildPlan,\n  field?: string,\n): T | undefined {\n  if (isDesign2(session)) {\n    const childPlan = getCurrentChildPlan(session);\n    if (!childPlan) return undefined;\n\n    const sectionData = childPlan[section];\n    if (!sectionData) return undefined;\n\n    if (field) {\n      return (sectionData as any)[field];\n    }\n    return sectionData as T;\n  }\n\n  // Design 1: get from main session\n  const sectionData = session[section as keyof CAPSession];\n  if (!sectionData) return undefined;\n\n  if (field) {\n    return (sectionData as any)[field];\n  }\n  return sectionData as T;\n}\n\n/**\n * Set a value in session, abstracting Design 1 vs Design 2\n * For Design 2, sets in current child's plan\n * For Design 1, sets in main session\n */\nexport function setSessionValue(\n  session: SessionLike,\n  section: keyof ChildPlan,\n  field: string,\n  value: any,\n): void {\n  if (isDesign2(session)) {\n    const currentIndex = getCurrentChildIndex(session);\n\n    // Ensure child plans exist\n    if (!session.childPlans) {\n      session.childPlans = [];\n    }\n\n    // Find or create child plan\n    let childPlan = session.childPlans.find((p) => p.childIndex === currentIndex);\n    if (!childPlan) {\n      childPlan = {\n        childIndex: currentIndex,\n        childName: session.namesOfChildren?.[currentIndex] ?? '',\n        isComplete: false,\n      };\n      session.childPlans.push(childPlan);\n    }\n\n    // Ensure section exists\n    if (!childPlan[section]) {\n      (childPlan as any)[section] = {};\n    }\n\n    // Set the field value\n    ((childPlan as any)[section] as any)[field] = value;\n  } else {\n    // Design 1: set in main session\n    if (!session[section as keyof CAPSession]) {\n      (session as any)[section] = {};\n    }\n    ((session as any)[section] as any)[field] = value;\n  }\n}\n\n/**\n * Set an entire section in session, abstracting Design 1 vs Design 2\n */\nexport function setSessionSection(\n  session: SessionLike,\n  section: keyof ChildPlan,\n  value: any,\n): void {\n  if (isDesign2(session)) {\n    const currentIndex = getCurrentChildIndex(session);\n\n    // Ensure child plans exist\n    if (!session.childPlans) {\n      session.childPlans = [];\n    }\n\n    // Find or create child plan\n    let childPlan = session.childPlans.find((p) => p.childIndex === currentIndex);\n    if (!childPlan) {\n      childPlan = {\n        childIndex: currentIndex,\n        childName: session.namesOfChildren?.[currentIndex] ?? '',\n        isComplete: false,\n      };\n      session.childPlans.push(childPlan);\n    }\n\n    // Set the section value\n    (childPlan as any)[section] = value;\n  } else {\n    // Design 1: set in main session\n    (session as any)[section] = value;\n  }\n}\n\n/**\n * Helper to create a PerChildAnswer for Design 1\n */\nexport function createPerChildAnswer<T>(defaultValue: T): PerChildAnswer<T> {\n  return {\n    default: defaultValue,\n  };\n}\n\n/**\n * Helper to get the default value from a PerChildAnswer or plain value\n */\nexport function getDefaultValue<T>(value: T | PerChildAnswer<T> | undefined): T | undefined {\n  if (!value) return undefined;\n  if (typeof value === 'object' && value !== null && 'default' in value) {\n    return (value as PerChildAnswer<T>).default;\n  }\n  return value as T;\n}\n\n/**\n * Helper to check if a value is a PerChildAnswer\n */\nexport function isPerChildAnswer<T>(value: any): value is PerChildAnswer<T> {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    'default' in value &&\n    (value.byChild === undefined || typeof value.byChild === 'object')\n  );\n}\n"],
  "mappings": "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",
  "names": ["sectionData"]
}
