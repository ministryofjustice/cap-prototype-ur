{
  "version": 3,
  "sources": ["../server/errorHandler.ts"],
  "sourcesContent": ["import type { Request, Response, NextFunction } from 'express';\nimport type { HTTPError } from 'superagent';\n\nimport config from './config';\nimport logger from './logging/logger';\n\n// Some user agents (notably Chrome) probe these URLs automatically.\n// They can safely 404 and shouldn't be logged as application errors.\nconst QUIET_404_PATH_PREFIXES = ['/.well-known/appspecific/'];\n\nfunction shouldQuiet404(request: Request, status: number): boolean {\n  if (status !== 404) return false;\n  return QUIET_404_PATH_PREFIXES.some((prefix) => request.originalUrl?.startsWith(prefix));\n}\n\nexport default function createErrorHandler() {\n  return (error: HTTPError, request: Request, response: Response, _next: NextFunction): void => {\n    const { production } = config;\n\n    const status = error.status || 500;\n\n    if (shouldQuiet404(request, status)) {\n      logger.debug(`404 for '${request.originalUrl}' (suppressed)`);\n    } else {\n      logger.error(`Error handling request for '${request.originalUrl}'`, error);\n    }\n\n    response.locals.status = status;\n    response.locals.stack = error.stack;\n\n    response.status(status);\n\n    return status === 404\n      ? response.render('pages/errors/notFound', { title: request.__('errors.notFound.title') })\n      : response.render('pages/errors/generic', {\n          production,\n          title: production ? request.__('errors.generic.title') : error.message,\n        });\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,oBAAmB;AACnB,oBAAmB;AAInB,MAAM,0BAA0B,CAAC,2BAA2B;AAE5D,SAAS,eAAe,SAAkB,QAAyB;AACjE,MAAI,WAAW,IAAK,QAAO;AAC3B,SAAO,wBAAwB,KAAK,CAAC,WAAW,QAAQ,aAAa,WAAW,MAAM,CAAC;AACzF;AAEe,SAAR,qBAAsC;AAC3C,SAAO,CAAC,OAAkB,SAAkB,UAAoB,UAA8B;AAC5F,UAAM,EAAE,WAAW,IAAI,cAAAA;AAEvB,UAAM,SAAS,MAAM,UAAU;AAE/B,QAAI,eAAe,SAAS,MAAM,GAAG;AACnC,oBAAAC,QAAO,MAAM,YAAY,QAAQ,WAAW,gBAAgB;AAAA,IAC9D,OAAO;AACL,oBAAAA,QAAO,MAAM,+BAA+B,QAAQ,WAAW,KAAK,KAAK;AAAA,IAC3E;AAEA,aAAS,OAAO,SAAS;AACzB,aAAS,OAAO,QAAQ,MAAM;AAE9B,aAAS,OAAO,MAAM;AAEtB,WAAO,WAAW,MACd,SAAS,OAAO,yBAAyB,EAAE,OAAO,QAAQ,GAAG,uBAAuB,EAAE,CAAC,IACvF,SAAS,OAAO,wBAAwB;AAAA,MACtC;AAAA,MACA,OAAO,aAAa,QAAQ,GAAG,sBAAsB,IAAI,MAAM;AAAA,IACjE,CAAC;AAAA,EACP;AACF;",
  "names": ["config", "logger"]
}
