{
  "version": 3,
  "sources": ["../../server/data/cacheClient.ts"],
  "sourcesContent": ["import { createClient } from 'redis';\n\nimport config from '../config';\nimport logger from '../logging/logger';\n\ntype CacheClient = ReturnType<typeof createClient>;\n\nconst url = `${config.cache.tls_enabled ? 'rediss' : 'redis'}://${config.cache.host}`;\n\nconst createCacheClient = (): CacheClient => {\n  const client = createClient({\n    url,\n    password: config.cache.password,\n    socket: {\n      reconnectStrategy: (attempts: number) => {\n        // Exponential back off: 20ms, 40ms, 80ms..., capped to retry every 30 seconds\n        const nextDelay = Math.min(2 ** attempts * 20, 30000);\n        logger.info(`Retry cache connection attempt: ${attempts}, next attempt in: ${nextDelay}ms`);\n        return nextDelay;\n      },\n    },\n  });\n\n  client.on('error', (e: Error) => logger.error('Cache client error', e));\n\n  return client;\n};\n\nexport default createCacheClient;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAA6B;AAE7B,oBAAmB;AACnB,oBAAmB;AAInB,MAAM,MAAM,GAAG,cAAAA,QAAO,MAAM,cAAc,WAAW,OAAO,MAAM,cAAAA,QAAO,MAAM,IAAI;AAEnF,MAAM,oBAAoB,MAAmB;AAC3C,QAAM,aAAS,2BAAa;AAAA,IAC1B;AAAA,IACA,UAAU,cAAAA,QAAO,MAAM;AAAA,IACvB,QAAQ;AAAA,MACN,mBAAmB,CAAC,aAAqB;AAEvC,cAAM,YAAY,KAAK,IAAI,KAAK,WAAW,IAAI,GAAK;AACpD,sBAAAC,QAAO,KAAK,mCAAmC,QAAQ,sBAAsB,SAAS,IAAI;AAC1F,eAAO;AAAA,MACT;AAAA,IACF;AAAA,EACF,CAAC;AAED,SAAO,GAAG,SAAS,CAAC,MAAa,cAAAA,QAAO,MAAM,sBAAsB,CAAC,CAAC;AAEtE,SAAO;AACT;AAEA,IAAO,sBAAQ;",
  "names": ["config", "logger"]
}
