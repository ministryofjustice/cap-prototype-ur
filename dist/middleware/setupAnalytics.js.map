{
  "version": 3,
  "sources": ["../../server/middleware/setupAnalytics.ts"],
  "sourcesContent": ["import { RequestHandler } from 'express';\n\nimport config from '../config';\nimport cookieNames from '../constants/cookieNames';\n\nexport default function setupAnalytics(): RequestHandler {\n  return (request, response, next) => {\n    // Set environment-level flag for internal analytics (link clicks, page exits)\n    // This allows internal tracking to work without cookie consent in dev/staging\n    response.locals.analyticsEnvironmentEnabled = config.analytics.enabled;\n\n    // If analytics is disabled at environment level, don't enable any analytics\n    if (!config.analytics.enabled) {\n      response.locals.analyticsEnabled = false;\n      response.locals.ga4Id = undefined;\n      return next();\n    }\n\n    response.locals.ga4Id = config.analytics.ga4Id;\n    try {\n      const cookiePolicy = JSON.parse(decodeURIComponent(request.cookies[cookieNames.ANALYTICS_CONSENT]));\n      if (cookiePolicy?.acceptAnalytics !== undefined) {\n        response.locals.analyticsEnabled = cookiePolicy.acceptAnalytics === 'Yes';\n      }\n    } catch {\n      /* empty - cookie policy is undefined */\n    }\n\n    return next();\n  };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,oBAAmB;AACnB,yBAAwB;AAET,SAAR,iBAAkD;AACvD,SAAO,CAAC,SAAS,UAAU,SAAS;AAGlC,aAAS,OAAO,8BAA8B,cAAAA,QAAO,UAAU;AAG/D,QAAI,CAAC,cAAAA,QAAO,UAAU,SAAS;AAC7B,eAAS,OAAO,mBAAmB;AACnC,eAAS,OAAO,QAAQ;AACxB,aAAO,KAAK;AAAA,IACd;AAEA,aAAS,OAAO,QAAQ,cAAAA,QAAO,UAAU;AACzC,QAAI;AACF,YAAM,eAAe,KAAK,MAAM,mBAAmB,QAAQ,QAAQ,mBAAAC,QAAY,iBAAiB,CAAC,CAAC;AAClG,UAAI,cAAc,oBAAoB,QAAW;AAC/C,iBAAS,OAAO,mBAAmB,aAAa,oBAAoB;AAAA,MACtE;AAAA,IACF,QAAQ;AAAA,IAER;AAEA,WAAO,KAAK;AAAA,EACd;AACF;",
  "names": ["config", "cookieNames"]
}
