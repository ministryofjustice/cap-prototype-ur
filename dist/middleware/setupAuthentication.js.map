{
  "version": 3,
  "sources": ["../../server/middleware/setupAuthentication.ts"],
  "sourcesContent": ["import url from 'url';\n\nimport { Router } from 'express';\nimport type { Request, Response, NextFunction } from 'express-serve-static-core';\n\nimport config from '../config';\nimport cookieNames from '../constants/cookieNames';\nimport paths from '../constants/paths';\nimport encryptPassword from '../utils/encryptPassword';\n\nconst setupAuthentication = () => {\n  const router = Router();\n\n  router.use((req: Request, res: Response, next: NextFunction) => {\n    if (!config.useAuth || isAuthenticated(req)) {\n      next();\n      return;\n    }\n    sendUserToPasswordPage(req, res);\n  });\n  return router;\n};\n\nconst sendUserToPasswordPage = (req: Request, res: Response) => {\n  const passwordPageURL = url.format({\n    pathname: paths.PASSWORD,\n    query: { returnURL: req.originalUrl },\n  });\n  res.redirect(passwordPageURL);\n};\n\nconst isAuthenticated = (req: Request) =>\n  config.passwords.map(encryptPassword).some((p) => p === req.cookies[cookieNames.AUTHENTICATION]);\n\nexport default setupAuthentication;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAAgB;AAEhB,qBAAuB;AAGvB,oBAAmB;AACnB,yBAAwB;AACxB,mBAAkB;AAClB,6BAA4B;AAE5B,MAAM,sBAAsB,MAAM;AAChC,QAAM,aAAS,uBAAO;AAEtB,SAAO,IAAI,CAAC,KAAc,KAAe,SAAuB;AAC9D,QAAI,CAAC,cAAAA,QAAO,WAAW,gBAAgB,GAAG,GAAG;AAC3C,WAAK;AACL;AAAA,IACF;AACA,2BAAuB,KAAK,GAAG;AAAA,EACjC,CAAC;AACD,SAAO;AACT;AAEA,MAAM,yBAAyB,CAAC,KAAc,QAAkB;AAC9D,QAAM,kBAAkB,WAAAC,QAAI,OAAO;AAAA,IACjC,UAAU,aAAAC,QAAM;AAAA,IAChB,OAAO,EAAE,WAAW,IAAI,YAAY;AAAA,EACtC,CAAC;AACD,MAAI,SAAS,eAAe;AAC9B;AAEA,MAAM,kBAAkB,CAAC,QACvB,cAAAF,QAAO,UAAU,IAAI,uBAAAG,OAAe,EAAE,KAAK,CAAC,MAAM,MAAM,IAAI,QAAQ,mBAAAC,QAAY,cAAc,CAAC;AAEjG,IAAO,8BAAQ;",
  "names": ["config", "url", "paths", "encryptPassword", "cookieNames"]
}
