{
  "version": 3,
  "sources": ["../../../server/pdf/components/splittableText.ts"],
  "sourcesContent": ["import { Paragraph } from '../../@types/pdf';\nimport { LINE_HEIGHT_RATIO, MM_PER_POINT } from '../../constants/pdfConstants';\nimport logger from '../../logging/logger'\nimport Pdf from '../pdf';\n\ntype SplittableParagraph = Paragraph & { splittable?: boolean };\ntype PotentialNewPageParagraph = Paragraph & { canStartNewPage?: boolean };\n\nclass SplittableText {\n  protected readonly pdf: Pdf;\n  private readonly paragraphs: SplittableParagraph[];\n\n  private stagedParagraphsHeight = 0;\n  private stagedParagraphsToAdd: Paragraph[] = [];\n\n  private readonly MIN_LINES_OF_TEXT = 3;\n\n  constructor(pdf: Pdf, paragraphs: SplittableParagraph[]) {\n    this.pdf = pdf;\n    this.paragraphs = paragraphs;\n  }\n\n  splitParagraph(paragraph: Paragraph) {\n    const paragraphs: PotentialNewPageParagraph[] = [];\n\n    const lines: string[] = this.pdf.splitParagraph(paragraph);\n\n    paragraphs.push({\n      text: lines.slice(0, this.MIN_LINES_OF_TEXT).join('\\n'),\n      size: paragraph.size,\n      style: paragraph.style,\n      bottomPadding: LINE_HEIGHT_RATIO * MM_PER_POINT,\n    });\n    lines.slice(3, lines.length).forEach((line) => {\n      paragraphs.push({\n        canStartNewPage: true,\n        text: line,\n        size: paragraph.size,\n        style: paragraph.style,\n        bottomPadding: LINE_HEIGHT_RATIO * MM_PER_POINT,\n      });\n    });\n    paragraphs[paragraphs.length - 1].bottomPadding = paragraph.bottomPadding;\n\n    return paragraphs;\n  }\n\n  addStagedParagraphsToDocument() {\n    if (this.pdf.heightWillOverflowDocument(this.stagedParagraphsHeight)) {\n      this.pdf.createNewPage();\n    }\n    if (this.pdf.heightWillOverflowDocument(this.stagedParagraphsHeight)) {\n      logger.error('Creating a PDF with an overflowing page');\n    }\n    this.stagedParagraphsToAdd.forEach((paragraph) => {\n      this.pdf.addParagraph(paragraph);\n    });\n    this.stagedParagraphsHeight = 0;\n    this.stagedParagraphsToAdd = [];\n  }\n\n  addParagraphToStaging(paragraph: Paragraph) {\n    this.stagedParagraphsHeight += this.pdf.getParagraphHeight(paragraph);\n    this.stagedParagraphsToAdd.push(paragraph);\n  }\n\n  addComponentToDocument() {\n    const splitParagraphs: PotentialNewPageParagraph[] = this.paragraphs.flatMap((paragraph) => {\n      if (paragraph.splittable) {\n        return this.splitParagraph(paragraph);\n      } else {\n        return paragraph;\n      }\n    });\n\n    splitParagraphs.forEach((paragraph) => {\n      if (paragraph.canStartNewPage) {\n        this.addStagedParagraphsToDocument();\n      }\n      return this.addParagraphToStaging(paragraph);\n    });\n\n    this.addStagedParagraphsToDocument();\n  }\n}\n\nexport default SplittableText;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,0BAAgD;AAChD,oBAAmB;AAMnB,MAAM,eAAe;AAAA,EACA;AAAA,EACF;AAAA,EAET,yBAAyB;AAAA,EACzB,wBAAqC,CAAC;AAAA,EAE7B,oBAAoB;AAAA,EAErC,YAAY,KAAU,YAAmC;AACvD,SAAK,MAAM;AACX,SAAK,aAAa;AAAA,EACpB;AAAA,EAEA,eAAe,WAAsB;AACnC,UAAM,aAA0C,CAAC;AAEjD,UAAM,QAAkB,KAAK,IAAI,eAAe,SAAS;AAEzD,eAAW,KAAK;AAAA,MACd,MAAM,MAAM,MAAM,GAAG,KAAK,iBAAiB,EAAE,KAAK,IAAI;AAAA,MACtD,MAAM,UAAU;AAAA,MAChB,OAAO,UAAU;AAAA,MACjB,eAAe,wCAAoB;AAAA,IACrC,CAAC;AACD,UAAM,MAAM,GAAG,MAAM,MAAM,EAAE,QAAQ,CAAC,SAAS;AAC7C,iBAAW,KAAK;AAAA,QACd,iBAAiB;AAAA,QACjB,MAAM;AAAA,QACN,MAAM,UAAU;AAAA,QAChB,OAAO,UAAU;AAAA,QACjB,eAAe,wCAAoB;AAAA,MACrC,CAAC;AAAA,IACH,CAAC;AACD,eAAW,WAAW,SAAS,CAAC,EAAE,gBAAgB,UAAU;AAE5D,WAAO;AAAA,EACT;AAAA,EAEA,gCAAgC;AAC9B,QAAI,KAAK,IAAI,2BAA2B,KAAK,sBAAsB,GAAG;AACpE,WAAK,IAAI,cAAc;AAAA,IACzB;AACA,QAAI,KAAK,IAAI,2BAA2B,KAAK,sBAAsB,GAAG;AACpE,oBAAAA,QAAO,MAAM,yCAAyC;AAAA,IACxD;AACA,SAAK,sBAAsB,QAAQ,CAAC,cAAc;AAChD,WAAK,IAAI,aAAa,SAAS;AAAA,IACjC,CAAC;AACD,SAAK,yBAAyB;AAC9B,SAAK,wBAAwB,CAAC;AAAA,EAChC;AAAA,EAEA,sBAAsB,WAAsB;AAC1C,SAAK,0BAA0B,KAAK,IAAI,mBAAmB,SAAS;AACpE,SAAK,sBAAsB,KAAK,SAAS;AAAA,EAC3C;AAAA,EAEA,yBAAyB;AACvB,UAAM,kBAA+C,KAAK,WAAW,QAAQ,CAAC,cAAc;AAC1F,UAAI,UAAU,YAAY;AACxB,eAAO,KAAK,eAAe,SAAS;AAAA,MACtC,OAAO;AACL,eAAO;AAAA,MACT;AAAA,IACF,CAAC;AAED,oBAAgB,QAAQ,CAAC,cAAc;AACrC,UAAI,UAAU,iBAAiB;AAC7B,aAAK,8BAA8B;AAAA,MACrC;AACA,aAAO,KAAK,sBAAsB,SAAS;AAAA,IAC7C,CAAC;AAED,SAAK,8BAA8B;AAAA,EACrC;AACF;AAEA,IAAO,yBAAQ;",
  "names": ["logger"]
}
