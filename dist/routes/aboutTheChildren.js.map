{
  "version": 3,
  "sources": ["../../server/routes/aboutTheChildren.ts"],
  "sourcesContent": ["import { Router } from 'express';\nimport { ValidationError } from 'express-validator';\n\nimport formFields from '../constants/formFields';\nimport FORM_STEPS from '../constants/formSteps';\nimport paths from '../constants/paths';\nimport checkFormProgressFromConfig  from '../middleware/checkFormProgressFromConfig';\nimport addCompletedStep from '../utils/addCompletedStep';\nimport { getBackUrl } from '../utils/sessionHelpers';\n\nconst aboutTheChildrenRoutes = (router: Router) => {\n  router.get(paths.ABOUT_THE_CHILDREN, checkFormProgressFromConfig(FORM_STEPS.ABOUT_THE_CHILDREN),(request, response) => {\n    const { numberOfChildren, namesOfChildren } = request.session;\n\n    if (numberOfChildren == null) {\n      return response.redirect(paths.NUMBER_OF_CHILDREN);\n    }\n\n    const formValues = {\n      ...Object.fromEntries(\n        Array.from({ length: numberOfChildren }, (_, i) => [formFields.CHILD_NAME + i, namesOfChildren?.[i]]),\n      ),\n      ...request.flash('formValues')?.[0],\n    };\n\n    return response.render('pages/aboutTheChildren', {\n      errors: request.flash('errors'),\n      formValues,\n      title:\n        numberOfChildren === 1\n          ? request.__('aboutTheChildren.singleTitle')\n          : request.__('aboutTheChildren.multipleTitle'),\n      backLinkHref: getBackUrl(request.session, paths.NUMBER_OF_CHILDREN),\n      numberOfChildren,\n    });\n  });\n\n  router.post(paths.ABOUT_THE_CHILDREN, (request, response) => {\n    const { numberOfChildren } = request.session;\n\n    const errors: ValidationError[] = [];\n    const values: Record<string, string> = {};\n\n    for (let i = 0; i < numberOfChildren; i++) {\n      const fieldName = formFields.CHILD_NAME + i;\n      const value: string | null = typeof request.body[fieldName] === 'string' ? request.body[fieldName].trim() : null;\n      if (!value) {\n        errors.push({\n          location: 'body',\n          msg: request.__('aboutTheChildren.error'),\n          path: fieldName,\n          type: 'field',\n        });\n      } else {\n        values[fieldName] = value;\n      }\n    }\n\n    if (errors.length > 0) {\n      request.flash('errors', errors);\n      request.flash('formValues', values);\n      return response.redirect(paths.ABOUT_THE_CHILDREN);\n    }\n\n    request.session.namesOfChildren = Object.values(values);\n\n    addCompletedStep(request, FORM_STEPS.ABOUT_THE_CHILDREN);\n    return response.redirect(paths.ABOUT_THE_ADULTS);\n  });\n};\n\nexport default aboutTheChildrenRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,wBAAuB;AACvB,uBAAuB;AACvB,mBAAkB;AAClB,yCAAyC;AACzC,8BAA6B;AAC7B,4BAA2B;AAE3B,MAAM,yBAAyB,CAAC,WAAmB;AACjD,SAAO,IAAI,aAAAA,QAAM,wBAAoB,mCAAAC,SAA4B,iBAAAC,QAAW,kBAAkB,GAAE,CAAC,SAAS,aAAa;AACrH,UAAM,EAAE,kBAAkB,gBAAgB,IAAI,QAAQ;AAEtD,QAAI,oBAAoB,MAAM;AAC5B,aAAO,SAAS,SAAS,aAAAF,QAAM,kBAAkB;AAAA,IACnD;AAEA,UAAM,aAAa;AAAA,MACjB,GAAG,OAAO;AAAA,QACR,MAAM,KAAK,EAAE,QAAQ,iBAAiB,GAAG,CAAC,GAAG,MAAM,CAAC,kBAAAG,QAAW,aAAa,GAAG,kBAAkB,CAAC,CAAC,CAAC;AAAA,MACtG;AAAA,MACA,GAAG,QAAQ,MAAM,YAAY,IAAI,CAAC;AAAA,IACpC;AAEA,WAAO,SAAS,OAAO,0BAA0B;AAAA,MAC/C,QAAQ,QAAQ,MAAM,QAAQ;AAAA,MAC9B;AAAA,MACA,OACE,qBAAqB,IACjB,QAAQ,GAAG,8BAA8B,IACzC,QAAQ,GAAG,gCAAgC;AAAA,MACjD,kBAAc,kCAAW,QAAQ,SAAS,aAAAH,QAAM,kBAAkB;AAAA,MAClE;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAED,SAAO,KAAK,aAAAA,QAAM,oBAAoB,CAAC,SAAS,aAAa;AAC3D,UAAM,EAAE,iBAAiB,IAAI,QAAQ;AAErC,UAAM,SAA4B,CAAC;AACnC,UAAM,SAAiC,CAAC;AAExC,aAAS,IAAI,GAAG,IAAI,kBAAkB,KAAK;AACzC,YAAM,YAAY,kBAAAG,QAAW,aAAa;AAC1C,YAAM,QAAuB,OAAO,QAAQ,KAAK,SAAS,MAAM,WAAW,QAAQ,KAAK,SAAS,EAAE,KAAK,IAAI;AAC5G,UAAI,CAAC,OAAO;AACV,eAAO,KAAK;AAAA,UACV,UAAU;AAAA,UACV,KAAK,QAAQ,GAAG,wBAAwB;AAAA,UACxC,MAAM;AAAA,UACN,MAAM;AAAA,QACR,CAAC;AAAA,MACH,OAAO;AACL,eAAO,SAAS,IAAI;AAAA,MACtB;AAAA,IACF;AAEA,QAAI,OAAO,SAAS,GAAG;AACrB,cAAQ,MAAM,UAAU,MAAM;AAC9B,cAAQ,MAAM,cAAc,MAAM;AAClC,aAAO,SAAS,SAAS,aAAAH,QAAM,kBAAkB;AAAA,IACnD;AAEA,YAAQ,QAAQ,kBAAkB,OAAO,OAAO,MAAM;AAEtD,gCAAAI,SAAiB,SAAS,iBAAAF,QAAW,kBAAkB;AACvD,WAAO,SAAS,SAAS,aAAAF,QAAM,gBAAgB;AAAA,EACjD,CAAC;AACH;AAEA,IAAO,2BAAQ;",
  "names": ["paths", "checkFormProgressFromConfig", "FORM_STEPS", "formFields", "addCompletedStep"]
}
