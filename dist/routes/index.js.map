{
  "version": 3,
  "sources": ["../../server/routes/index.ts"],
  "sourcesContent": ["import { Router } from 'express';\n\nimport config from '../config';\nimport FORM_STEPS from '../constants/formSteps';\nimport paths from '../constants/paths';\nimport addCompletedStep from '../utils/addCompletedStep';\n\nimport aboutTheAdultsRoutes from './aboutTheAdults';\nimport aboutTheChildrenRoutes from './aboutTheChildren';\nimport accessibilityStatementRoutes from './accessibilityStatement';\nimport analyticsRoutes from './analytics';\nimport checkYourAnswersRoutes from './checkYourAnswers';\nimport childrenSafetyRoutesCheck from './childrenSafetyCheck';\nimport confirmationRoutes from './confirmation';\nimport courtOrderCheckRoutes from './courtOrderCheck';\nimport decisionMakingRoutes from './decisionMaking';\nimport doWhatsBestRoutes from './doWhatsBest';\nimport downloadRoutes from './downloads';\nimport existingCourtOrderRoutes from './existingCourtOrder';\nimport handoverAndHolidaysRoutes from './handoverAndHolidays';\nimport livingAndVisitingRoutes from './livingAndVisiting';\nimport numberOfChildrenRoutes from './numberOfChildren';\nimport otherThingsRoutes from './otherThings';\nimport perChildDesignRoutes from './perChildDesign';\nimport safetyCheckRoutes from './safetyCheck';\nimport sharePlanRoutes from './sharePlan';\nimport specialDaysRoutes from './specialDays';\nimport taskListRoutes from './taskList';\n\n\nconst routes = (): Router => {\n  const router = Router();\n\n  // GET start page\n  router.get(paths.START, (request, response) => {\n    // In production (live service), skip the start page and redirect to safety check\n    if (config.isLiveService) {\n      return response.redirect(paths.SAFETY_CHECK);\n    }\n    addCompletedStep(request, FORM_STEPS.START);\n    const { usePerChildPoC, perChildDesignMode } = request.session;\n    let currentDesignMode = 'current';\n    if (usePerChildPoC) {\n      currentDesignMode = perChildDesignMode || 'design1';\n    }\n    response.render('pages/index', {\n      showUrToggle: true,\n      usePerChildPoC: usePerChildPoC || false,\n      currentDesignMode,\n    });\n  });\n\n  // POST start page - handle service version selection\n  router.post(paths.START, (request, response) => {\n    const { serviceVersion } = request.body;\n\n    // Map service version to session flags\n    const validDesigns = ['current', 'design1', 'design2', 'design3', 'design4', 'poc'];\n    const design = validDesigns.includes(serviceVersion) ? serviceVersion : 'current';\n    const newUsePerChildPoC = design !== 'current';\n    const newDesignMode = design !== 'current' && design !== 'poc' ? design : (design === 'poc' ? 'design1' : undefined);\n\n    // Clear session data when starting fresh, but preserve session ID to keep CSRF token valid\n    delete request.session.numberOfChildren;\n    delete request.session.namesOfChildren;\n    delete request.session.initialAdultName;\n    delete request.session.secondaryAdultName;\n    delete request.session.perChildDesignMode;\n    delete request.session.currentChildIndex;\n    delete request.session.childPlans;\n    delete request.session.livingAndVisiting;\n    delete request.session.handoverAndHolidays;\n    delete request.session.specialDays;\n    delete request.session.otherThings;\n    delete request.session.decisionMaking;\n\n    // Set the new service version and initialize completedSteps with START\n    request.session.usePerChildPoC = newUsePerChildPoC;\n    if (newDesignMode) {\n      request.session.perChildDesignMode = newDesignMode as any;\n    }\n    request.session.completedSteps = [FORM_STEPS.START];\n    request.session.planStartTime = Date.now();\n    response.redirect(paths.SAFETY_CHECK);\n  });\n\n  analyticsRoutes(router);\n  safetyCheckRoutes(router);\n  childrenSafetyRoutesCheck(router);\n  doWhatsBestRoutes(router);\n  courtOrderCheckRoutes(router);\n  existingCourtOrderRoutes(router);\n  numberOfChildrenRoutes(router);\n  aboutTheChildrenRoutes(router);\n  aboutTheAdultsRoutes(router);\n  taskListRoutes(router);\n  checkYourAnswersRoutes(router);\n  sharePlanRoutes(router);\n  confirmationRoutes(router);\n  livingAndVisitingRoutes(router);\n  handoverAndHolidaysRoutes(router);\n  specialDaysRoutes(router);\n  otherThingsRoutes(router);\n  decisionMakingRoutes(router);\n  downloadRoutes(router);\n  accessibilityStatementRoutes(router);\n  perChildDesignRoutes(router);\n\n  return router;\n};\n\nexport default routes;\n"],
  "mappings": "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",
  "names": ["paths", "config", "addCompletedStep", "FORM_STEPS", "analyticsRoutes", "safetyCheckRoutes", "childrenSafetyRoutesCheck", "doWhatsBestRoutes", "courtOrderCheckRoutes", "existingCourtOrderRoutes", "numberOfChildrenRoutes", "aboutTheChildrenRoutes", "aboutTheAdultsRoutes", "taskListRoutes", "checkYourAnswersRoutes", "sharePlanRoutes", "confirmationRoutes", "livingAndVisitingRoutes", "handoverAndHolidaysRoutes", "specialDaysRoutes", "otherThingsRoutes", "decisionMakingRoutes", "downloadRoutes", "accessibilityStatementRoutes", "perChildDesignRoutes"]
}
