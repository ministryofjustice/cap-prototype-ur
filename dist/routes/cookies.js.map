{
  "version": 3,
  "sources": ["../../server/routes/cookies.ts"],
  "sourcesContent": ["import type { Router } from 'express-serve-static-core';\n\nimport { yesOrNo } from '../@types/fields';\nimport config from '../config';\nimport cookieNames from '../constants/cookieNames';\nimport formFields from '../constants/formFields';\nimport paths from '../constants/paths';\nimport logger from '../logging/logger';\nimport { getBackUrl } from '../utils/sessionHelpers';\n\nconst cookiesRoutes = (router: Router) => {\n  router.get(paths.COOKIES, (request, response) => {\n    response.render('pages/cookies', {\n      title: request.__('cookies.title'),\n      backLinkHref: getBackUrl(request.session, paths.START),\n    });\n  });\n\n  router.post(paths.COOKIES, (request, response) => {\n    logger.info(`Accepted analytics. POST ${paths.COOKIES}`);\n    const acceptAnalytics = request.body[formFields.ACCEPT_OPTIONAL_COOKIES] as yesOrNo;\n\n    response.cookie(cookieNames.ANALYTICS_CONSENT, JSON.stringify({ acceptAnalytics }), {\n      maxAge: 1000 * 60 * 60 * 24 * 365, // One Year\n      secure: config.useHttps,\n      httpOnly: false,\n      sameSite: 'lax',\n    });\n\n    if (acceptAnalytics === 'No') {\n      const domain = request.hostname;\n\n      response.clearCookie('_ga', { domain, secure: false, httpOnly: false });\n      response.clearCookie(`_ga_${config.analytics.ga4Id.replace('G-', '')}`, {\n        domain,\n        secure: false,\n        httpOnly: false,\n      });\n    }\n\n    return response.redirect(paths.COOKIES);\n  });\n};\n\nexport default cookiesRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,oBAAmB;AACnB,yBAAwB;AACxB,wBAAuB;AACvB,mBAAkB;AAClB,oBAAmB;AACnB,4BAA2B;AAE3B,MAAM,gBAAgB,CAAC,WAAmB;AACxC,SAAO,IAAI,aAAAA,QAAM,SAAS,CAAC,SAAS,aAAa;AAC/C,aAAS,OAAO,iBAAiB;AAAA,MAC/B,OAAO,QAAQ,GAAG,eAAe;AAAA,MACjC,kBAAc,kCAAW,QAAQ,SAAS,aAAAA,QAAM,KAAK;AAAA,IACvD,CAAC;AAAA,EACH,CAAC;AAED,SAAO,KAAK,aAAAA,QAAM,SAAS,CAAC,SAAS,aAAa;AAChD,kBAAAC,QAAO,KAAK,4BAA4B,aAAAD,QAAM,OAAO,EAAE;AACvD,UAAM,kBAAkB,QAAQ,KAAK,kBAAAE,QAAW,uBAAuB;AAEvE,aAAS,OAAO,mBAAAC,QAAY,mBAAmB,KAAK,UAAU,EAAE,gBAAgB,CAAC,GAAG;AAAA,MAClF,QAAQ,MAAO,KAAK,KAAK,KAAK;AAAA;AAAA,MAC9B,QAAQ,cAAAC,QAAO;AAAA,MACf,UAAU;AAAA,MACV,UAAU;AAAA,IACZ,CAAC;AAED,QAAI,oBAAoB,MAAM;AAC5B,YAAM,SAAS,QAAQ;AAEvB,eAAS,YAAY,OAAO,EAAE,QAAQ,QAAQ,OAAO,UAAU,MAAM,CAAC;AACtE,eAAS,YAAY,OAAO,cAAAA,QAAO,UAAU,MAAM,QAAQ,MAAM,EAAE,CAAC,IAAI;AAAA,QACtE;AAAA,QACA,QAAQ;AAAA,QACR,UAAU;AAAA,MACZ,CAAC;AAAA,IACH;AAEA,WAAO,SAAS,SAAS,aAAAJ,QAAM,OAAO;AAAA,EACxC,CAAC;AACH;AAEA,IAAO,kBAAQ;",
  "names": ["paths", "logger", "formFields", "cookieNames", "config"]
}
