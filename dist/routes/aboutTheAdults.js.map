{
  "version": 3,
  "sources": ["../../server/routes/aboutTheAdults.ts"],
  "sourcesContent": ["import { Router } from 'express';\nimport { body, matchedData, validationResult } from 'express-validator';\n\nimport formFields from '../constants/formFields';\nimport FORM_STEPS from '../constants/formSteps';\nimport paths from '../constants/paths';\nimport checkFormProgressFromConfig  from '../middleware/checkFormProgressFromConfig';\nimport addCompletedStep from '../utils/addCompletedStep';\nimport { getBackUrl, getRedirectUrlAfterFormSubmit } from '../utils/sessionHelpers';\n\nconst aboutTheAdultsRoutes = (router: Router) => {\n  router.get(paths.ABOUT_THE_ADULTS, checkFormProgressFromConfig(FORM_STEPS.ABOUT_THE_ADULTS), (request, response) => {\n    const formValues = {\n      [formFields.INITIAL_ADULT_NAME]: request.session.initialAdultName,\n      [formFields.SECONDARY_ADULT_NAME]: request.session.secondaryAdultName,\n      ...request.flash('formValues')?.[0],\n    };\n\n    response.render('pages/aboutTheAdults', {\n      errors: request.flash('errors'),\n      formValues,\n      title: request.__('aboutTheAdults.title'),\n      backLinkHref: getBackUrl(request.session, paths.ABOUT_THE_CHILDREN),\n    });\n  });\n\n  router.post(\n    paths.ABOUT_THE_ADULTS,\n    body(formFields.INITIAL_ADULT_NAME)\n      .trim()\n      .notEmpty()\n      .withMessage((_value, { req }) => req.__('aboutTheAdults.initialError')),\n    body(formFields.SECONDARY_ADULT_NAME)\n      .trim()\n      .notEmpty()\n      .withMessage((_value, { req }) => req.__('aboutTheAdults.secondaryError')),\n    body(formFields.SECONDARY_ADULT_NAME)\n      .custom((value: string, { req }) => value !== req.body[formFields.INITIAL_ADULT_NAME])\n      .withMessage((_value, { req }) => req.__('aboutTheAdults.sameNameError')),\n    (request, response) => {\n      const formData = matchedData<{\n        [formFields.INITIAL_ADULT_NAME]: string;\n        [formFields.SECONDARY_ADULT_NAME]: string;\n      }>(request, { onlyValidData: false });\n      const errors = validationResult(request);\n\n      if (!errors.isEmpty()) {\n        request.flash('errors', errors.array());\n        request.flash('formValues', formData);\n        return response.redirect(paths.ABOUT_THE_ADULTS);\n      }\n\n      request.session.initialAdultName = formData[formFields.INITIAL_ADULT_NAME];\n      request.session.secondaryAdultName = formData[formFields.SECONDARY_ADULT_NAME];\n\n      addCompletedStep(request, FORM_STEPS.ABOUT_THE_ADULTS);\n      return response.redirect(getRedirectUrlAfterFormSubmit(request.session, paths.TASK_LIST));\n    },\n  );\n};\n\nexport default aboutTheAdultsRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,+BAAoD;AAEpD,wBAAuB;AACvB,uBAAuB;AACvB,mBAAkB;AAClB,yCAAyC;AACzC,8BAA6B;AAC7B,4BAA0D;AAE1D,MAAM,uBAAuB,CAAC,WAAmB;AAC/C,SAAO,IAAI,aAAAA,QAAM,sBAAkB,mCAAAC,SAA4B,iBAAAC,QAAW,gBAAgB,GAAG,CAAC,SAAS,aAAa;AAClH,UAAM,aAAa;AAAA,MACjB,CAAC,kBAAAC,QAAW,kBAAkB,GAAG,QAAQ,QAAQ;AAAA,MACjD,CAAC,kBAAAA,QAAW,oBAAoB,GAAG,QAAQ,QAAQ;AAAA,MACnD,GAAG,QAAQ,MAAM,YAAY,IAAI,CAAC;AAAA,IACpC;AAEA,aAAS,OAAO,wBAAwB;AAAA,MACtC,QAAQ,QAAQ,MAAM,QAAQ;AAAA,MAC9B;AAAA,MACA,OAAO,QAAQ,GAAG,sBAAsB;AAAA,MACxC,kBAAc,kCAAW,QAAQ,SAAS,aAAAH,QAAM,kBAAkB;AAAA,IACpE,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL,aAAAA,QAAM;AAAA,QACN,+BAAK,kBAAAG,QAAW,kBAAkB,EAC/B,KAAK,EACL,SAAS,EACT,YAAY,CAAC,QAAQ,EAAE,IAAI,MAAM,IAAI,GAAG,6BAA6B,CAAC;AAAA,QACzE,+BAAK,kBAAAA,QAAW,oBAAoB,EACjC,KAAK,EACL,SAAS,EACT,YAAY,CAAC,QAAQ,EAAE,IAAI,MAAM,IAAI,GAAG,+BAA+B,CAAC;AAAA,QAC3E,+BAAK,kBAAAA,QAAW,oBAAoB,EACjC,OAAO,CAAC,OAAe,EAAE,IAAI,MAAM,UAAU,IAAI,KAAK,kBAAAA,QAAW,kBAAkB,CAAC,EACpF,YAAY,CAAC,QAAQ,EAAE,IAAI,MAAM,IAAI,GAAG,8BAA8B,CAAC;AAAA,IAC1E,CAAC,SAAS,aAAa;AACrB,YAAM,eAAW,sCAGd,SAAS,EAAE,eAAe,MAAM,CAAC;AACpC,YAAM,aAAS,2CAAiB,OAAO;AAEvC,UAAI,CAAC,OAAO,QAAQ,GAAG;AACrB,gBAAQ,MAAM,UAAU,OAAO,MAAM,CAAC;AACtC,gBAAQ,MAAM,cAAc,QAAQ;AACpC,eAAO,SAAS,SAAS,aAAAH,QAAM,gBAAgB;AAAA,MACjD;AAEA,cAAQ,QAAQ,mBAAmB,SAAS,kBAAAG,QAAW,kBAAkB;AACzE,cAAQ,QAAQ,qBAAqB,SAAS,kBAAAA,QAAW,oBAAoB;AAE7E,kCAAAC,SAAiB,SAAS,iBAAAF,QAAW,gBAAgB;AACrD,aAAO,SAAS,aAAS,qDAA8B,QAAQ,SAAS,aAAAF,QAAM,SAAS,CAAC;AAAA,IAC1F;AAAA,EACF;AACF;AAEA,IAAO,yBAAQ;",
  "names": ["paths", "checkFormProgressFromConfig", "FORM_STEPS", "formFields", "addCompletedStep"]
}
