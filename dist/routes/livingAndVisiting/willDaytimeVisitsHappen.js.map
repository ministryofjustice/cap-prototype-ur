{
  "version": 3,
  "sources": ["../../../server/routes/livingAndVisiting/willDaytimeVisitsHappen.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Router } from 'express';\nimport { body, matchedData, validationResult } from 'express-validator';\n\nimport { yesOrNo } from '../../@types/fields';\nimport formFields from '../../constants/formFields';\nimport FORM_STEPS from '../../constants/formSteps';\nimport paths from '../../constants/paths';\nimport checkFormProgressFromConfig  from '../../middleware/checkFormProgressFromConfig';\nimport addCompletedStep from '../../utils/addCompletedStep';\nimport { convertBooleanValueToRadioButtonValue } from '../../utils/formValueUtils';\nimport { getSessionValue, setSessionSection } from '../../utils/perChildSession';\nimport { parentNotMostlyLivedWith, getBackUrl, getRedirectUrlAfterFormSubmit } from '../../utils/sessionHelpers';\n\nconst willDaytimeVisitsHappenRoutes = (router: Router) => {\n  router.get(paths.LIVING_VISITING_WILL_DAYTIME_VISITS_HAPPEN, checkFormProgressFromConfig(FORM_STEPS.LIVING_VISITING_WILL_DAYTIME_VISITS_HAPPEN), (request, response) => {\n    const livingAndVisiting = getSessionValue<any>(request.session, 'livingAndVisiting');\n\n    response.render('pages/livingAndVisiting/willDaytimeVisitsHappen', {\n      errors: request.flash('errors'),\n      title: request.__('livingAndVisiting.willDaytimeVisitsHappen.title', {\n        adult: parentNotMostlyLivedWith(request.session),\n      }),\n      backLinkHref: getBackUrl(request.session, paths.LIVING_VISITING_WILL_OVERNIGHTS_HAPPEN),\n      formValues: {\n        [formFields.WILL_DAYTIME_VISITS_HAPPEN]: convertBooleanValueToRadioButtonValue(\n          livingAndVisiting?.daytimeVisits?.willHappen,\n        ),\n      },\n    });\n  });\n\n  router.post(\n    paths.LIVING_VISITING_WILL_DAYTIME_VISITS_HAPPEN,\n    body(formFields.WILL_DAYTIME_VISITS_HAPPEN)\n      .exists()\n      .withMessage((_value, { req }) => req.__('livingAndVisiting.willDaytimeVisitsHappen.error')),\n    (request, response) => {\n      const errors = validationResult(request);\n\n      if (!errors.isEmpty()) {\n        request.flash('errors', errors.array());\n        return response.redirect(paths.LIVING_VISITING_WILL_DAYTIME_VISITS_HAPPEN);\n      }\n\n      const formData = matchedData<{\n        [formFields.WILL_DAYTIME_VISITS_HAPPEN]: yesOrNo;\n      }>(request);\n\n      const willDaytimeVisitsHappen = formData[formFields.WILL_DAYTIME_VISITS_HAPPEN] === 'Yes';\n\n      const livingAndVisiting = getSessionValue<any>(request.session, 'livingAndVisiting') || {};\n      if (livingAndVisiting?.daytimeVisits?.willHappen !== willDaytimeVisitsHappen) {\n        setSessionSection(request.session, 'livingAndVisiting', {\n          ...livingAndVisiting,\n          daytimeVisits: {\n            willHappen: willDaytimeVisitsHappen,\n          },\n        });\n      }\n\n      if (willDaytimeVisitsHappen) {\n        addCompletedStep(request, FORM_STEPS.LIVING_VISITING_WILL_DAYTIME_VISITS_HAPPEN);\n        return response.redirect(paths.LIVING_VISITING_WHICH_DAYS_DAYTIME_VISITS);\n      }\n\n      addCompletedStep(request, FORM_STEPS.LIVING_VISITING_WILL_DAYTIME_VISITS_HAPPEN);\n\n      return response.redirect(getRedirectUrlAfterFormSubmit(request.session, paths.TASK_LIST));\n    },\n  );\n};\n\nexport default willDaytimeVisitsHappenRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,+BAAoD;AAGpD,wBAAuB;AACvB,uBAAuB;AACvB,mBAAkB;AAClB,yCAAyC;AACzC,8BAA6B;AAC7B,4BAAsD;AACtD,6BAAmD;AACnD,4BAAoF;AAEpF,MAAM,gCAAgC,CAAC,WAAmB;AACxD,SAAO,IAAI,aAAAA,QAAM,gDAA4C,mCAAAC,SAA4B,iBAAAC,QAAW,0CAA0C,GAAG,CAAC,SAAS,aAAa;AACtK,UAAM,wBAAoB,wCAAqB,QAAQ,SAAS,mBAAmB;AAEnF,aAAS,OAAO,mDAAmD;AAAA,MACjE,QAAQ,QAAQ,MAAM,QAAQ;AAAA,MAC9B,OAAO,QAAQ,GAAG,mDAAmD;AAAA,QACnE,WAAO,gDAAyB,QAAQ,OAAO;AAAA,MACjD,CAAC;AAAA,MACD,kBAAc,kCAAW,QAAQ,SAAS,aAAAF,QAAM,sCAAsC;AAAA,MACtF,YAAY;AAAA,QACV,CAAC,kBAAAG,QAAW,0BAA0B,OAAG;AAAA,UACvC,mBAAmB,eAAe;AAAA,QACpC;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL,aAAAH,QAAM;AAAA,QACN,+BAAK,kBAAAG,QAAW,0BAA0B,EACvC,OAAO,EACP,YAAY,CAAC,QAAQ,EAAE,IAAI,MAAM,IAAI,GAAG,iDAAiD,CAAC;AAAA,IAC7F,CAAC,SAAS,aAAa;AACrB,YAAM,aAAS,2CAAiB,OAAO;AAEvC,UAAI,CAAC,OAAO,QAAQ,GAAG;AACrB,gBAAQ,MAAM,UAAU,OAAO,MAAM,CAAC;AACtC,eAAO,SAAS,SAAS,aAAAH,QAAM,0CAA0C;AAAA,MAC3E;AAEA,YAAM,eAAW,sCAEd,OAAO;AAEV,YAAM,0BAA0B,SAAS,kBAAAG,QAAW,0BAA0B,MAAM;AAEpF,YAAM,wBAAoB,wCAAqB,QAAQ,SAAS,mBAAmB,KAAK,CAAC;AACzF,UAAI,mBAAmB,eAAe,eAAe,yBAAyB;AAC5E,sDAAkB,QAAQ,SAAS,qBAAqB;AAAA,UACtD,GAAG;AAAA,UACH,eAAe;AAAA,YACb,YAAY;AAAA,UACd;AAAA,QACF,CAAC;AAAA,MACH;AAEA,UAAI,yBAAyB;AAC3B,oCAAAC,SAAiB,SAAS,iBAAAF,QAAW,0CAA0C;AAC/E,eAAO,SAAS,SAAS,aAAAF,QAAM,yCAAyC;AAAA,MAC1E;AAEA,kCAAAI,SAAiB,SAAS,iBAAAF,QAAW,0CAA0C;AAE/E,aAAO,SAAS,aAAS,qDAA8B,QAAQ,SAAS,aAAAF,QAAM,SAAS,CAAC;AAAA,IAC1F;AAAA,EACF;AACF;AAEA,IAAO,kCAAQ;",
  "names": ["paths", "checkFormProgressFromConfig", "FORM_STEPS", "formFields", "addCompletedStep"]
}
