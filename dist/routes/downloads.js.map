{
  "version": 3,
  "sources": ["../../server/routes/downloads.ts"],
  "sourcesContent": ["import fs from 'fs';\n\nimport { Router } from 'express';\n\nimport paths from '../constants/paths';\nimport createHtmlContent from '../html/createHtmlContent';\nimport createPdf from '../pdf/createPdf';\nimport { logDownload } from '../services/analyticsService';\nimport getAssetPath from '../utils/getAssetPath';\nimport { formattedChildrenNames } from '../utils/sessionHelpers';\n\n/**\n * Routes for downloading and exporting the care arrangement plan\n * Handles multiple export formats: PDF, HTML, and paper forms\n */\nconst downloadRoutes = (router: Router) => {\n  router.get(paths.DOWNLOAD_PDF, (request, response) => {\n    const pdf = createPdf(false, request);\n\n    response.setHeader('Content-Type', 'application/pdf');\n    response.setHeader('Content-Disposition', `attachment; filename=${request.__('pdf.name')}.pdf`);\n    response.send(Buffer.from(pdf));\n\n    // Log download event\n    logDownload(request, 'output_pdf');\n  });\n\n  router.get(paths.PRINT_PDF, (request, response) => {\n    const pdf = createPdf(true, request);\n\n    response.setHeader('Content-Type', 'application/pdf');\n    response.setHeader('Content-Disposition', `inline; filename=${request.__('pdf.name')}.pdf`);\n    response.send(Buffer.from(pdf));\n  });\n\n  router.get(paths.DOWNLOAD_PAPER_FORM, (request, response) => {\n    response.download(getAssetPath('other/paperForm.pdf'), `${request.__('pdf.name')}.pdf`);\n\n    // Log download event\n    logDownload(request, 'offline_pdf');\n  });\n\n  router.get(paths.DOWNLOAD_HTML, (request, response) => {\n    const htmlContent = createHtmlContent(request);\n    const childrenNames = formattedChildrenNames(request);\n\n    // Load logo image as base64\n    const logoData = fs.readFileSync(getAssetPath('images/crest.png'), { encoding: 'base64' });\n    const logoImageData = `data:image/png;base64,${logoData}`;\n\n    response.setHeader('Content-Type', 'text/html; charset=utf-8');\n    response.setHeader('Content-Disposition', `attachment; filename=${request.__('pdf.name')}.html`);\n\n    response.render('pages/downloadablePlan', {\n      values: {\n        initialAdultName: request.session.initialAdultName,\n        secondaryAdultName: request.session.secondaryAdultName,\n        numberOfChildren: request.session.numberOfChildren,\n        childrenNames,\n      },\n      htmlContent,\n      logoImageData,\n    });\n\n    // Log download event\n    logDownload(request, 'output_html');\n  });\n};\n\nexport default downloadRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAe;AAIf,mBAAkB;AAClB,+BAA8B;AAC9B,uBAAsB;AACtB,8BAA4B;AAC5B,0BAAyB;AACzB,4BAAuC;AAMvC,MAAM,iBAAiB,CAAC,WAAmB;AACzC,SAAO,IAAI,aAAAA,QAAM,cAAc,CAAC,SAAS,aAAa;AACpD,UAAM,UAAM,iBAAAC,SAAU,OAAO,OAAO;AAEpC,aAAS,UAAU,gBAAgB,iBAAiB;AACpD,aAAS,UAAU,uBAAuB,wBAAwB,QAAQ,GAAG,UAAU,CAAC,MAAM;AAC9F,aAAS,KAAK,OAAO,KAAK,GAAG,CAAC;AAG9B,6CAAY,SAAS,YAAY;AAAA,EACnC,CAAC;AAED,SAAO,IAAI,aAAAD,QAAM,WAAW,CAAC,SAAS,aAAa;AACjD,UAAM,UAAM,iBAAAC,SAAU,MAAM,OAAO;AAEnC,aAAS,UAAU,gBAAgB,iBAAiB;AACpD,aAAS,UAAU,uBAAuB,oBAAoB,QAAQ,GAAG,UAAU,CAAC,MAAM;AAC1F,aAAS,KAAK,OAAO,KAAK,GAAG,CAAC;AAAA,EAChC,CAAC;AAED,SAAO,IAAI,aAAAD,QAAM,qBAAqB,CAAC,SAAS,aAAa;AAC3D,aAAS,aAAS,oBAAAE,SAAa,qBAAqB,GAAG,GAAG,QAAQ,GAAG,UAAU,CAAC,MAAM;AAGtF,6CAAY,SAAS,aAAa;AAAA,EACpC,CAAC;AAED,SAAO,IAAI,aAAAF,QAAM,eAAe,CAAC,SAAS,aAAa;AACrD,UAAM,kBAAc,yBAAAG,SAAkB,OAAO;AAC7C,UAAM,oBAAgB,8CAAuB,OAAO;AAGpD,UAAM,WAAW,UAAAC,QAAG,iBAAa,oBAAAF,SAAa,kBAAkB,GAAG,EAAE,UAAU,SAAS,CAAC;AACzF,UAAM,gBAAgB,yBAAyB,QAAQ;AAEvD,aAAS,UAAU,gBAAgB,0BAA0B;AAC7D,aAAS,UAAU,uBAAuB,wBAAwB,QAAQ,GAAG,UAAU,CAAC,OAAO;AAE/F,aAAS,OAAO,0BAA0B;AAAA,MACxC,QAAQ;AAAA,QACN,kBAAkB,QAAQ,QAAQ;AAAA,QAClC,oBAAoB,QAAQ,QAAQ;AAAA,QACpC,kBAAkB,QAAQ,QAAQ;AAAA,QAClC;AAAA,MACF;AAAA,MACA;AAAA,MACA;AAAA,IACF,CAAC;AAGD,6CAAY,SAAS,aAAa;AAAA,EACpC,CAAC;AACH;AAEA,IAAO,oBAAQ;",
  "names": ["paths", "createPdf", "getAssetPath", "createHtmlContent", "fs"]
}
