{
  "version": 3,
  "sources": ["../../../server/routes/handoverAndHolidays/willChangeDuringSchoolHolidays.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Router } from 'express';\nimport { body, matchedData, validationResult } from 'express-validator';\n\nimport { yesOrNo } from '../../@types/fields';\nimport formFields from '../../constants/formFields';\nimport FORM_STEPS from '../../constants/formSteps';\nimport paths from '../../constants/paths';\nimport checkFormProgressFromConfig from '../../middleware/checkFormProgressFromConfig';\nimport addCompletedStep from '../../utils/addCompletedStep';\nimport { convertBooleanValueToRadioButtonValue } from '../../utils/formValueUtils';\nimport { getSessionValue, setSessionSection } from '../../utils/perChildSession';\nimport { getBackUrl } from '../../utils/sessionHelpers';\n\nconst willChangeDuringSchoolHolidaysRoutes = (router: Router) => {\n  router.get(paths.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS, checkFormProgressFromConfig(FORM_STEPS.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS), (request, response) => {\n    const handoverAndHolidays = getSessionValue<any>(request.session, 'handoverAndHolidays');\n\n    response.render('pages/handoverAndHolidays/willChangeDuringSchoolHolidays', {\n      errors: request.flash('errors'),\n      title: request.__('handoverAndHolidays.willChangeDuringSchoolHolidays.title'),\n      backLinkHref: getBackUrl(request.session, paths.HANDOVER_HOLIDAYS_WHERE_HANDOVER),\n      formValues: {\n        [formFields.WILL_CHANGE_DURING_SCHOOL_HOLIDAYS]: convertBooleanValueToRadioButtonValue(\n          handoverAndHolidays?.willChangeDuringSchoolHolidays?.willChange,\n        ),\n      },\n    });\n  });\n\n  router.post(\n    paths.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS,\n    body(formFields.WILL_CHANGE_DURING_SCHOOL_HOLIDAYS)\n      .exists()\n      .withMessage((_value, { req }) => req.__('handoverAndHolidays.willChangeDuringSchoolHolidays.error')),\n    (request, response) => {\n      const errors = validationResult(request);\n\n      if (!errors.isEmpty()) {\n        request.flash('errors', errors.array());\n        return response.redirect(paths.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS);\n      }\n\n      const formData = matchedData<{\n        [formFields.WILL_CHANGE_DURING_SCHOOL_HOLIDAYS]: yesOrNo;\n      }>(request);\n\n      const willArrangementsChange = formData[formFields.WILL_CHANGE_DURING_SCHOOL_HOLIDAYS] === 'Yes';\n\n      const handoverAndHolidays = getSessionValue<any>(request.session, 'handoverAndHolidays') || {};\n      setSessionSection(request.session, 'handoverAndHolidays', {\n        ...handoverAndHolidays,\n        willChangeDuringSchoolHolidays: {\n          noDecisionRequired: false,\n          willChange: willArrangementsChange,\n        },\n      });\n\n      if (willArrangementsChange) {\n        addCompletedStep(request, FORM_STEPS.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS);\n        return response.redirect(paths.HANDOVER_HOLIDAYS_HOW_CHANGE_DURING_SCHOOL_HOLIDAYS);\n      }\n\n      const updatedHandoverAndHolidays = getSessionValue<any>(request.session, 'handoverAndHolidays') || {};\n      delete updatedHandoverAndHolidays.howChangeDuringSchoolHolidays;\n      setSessionSection(request.session, 'handoverAndHolidays', updatedHandoverAndHolidays);\n\n      addCompletedStep(request, FORM_STEPS.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS);\n\n      return response.redirect(paths.HANDOVER_HOLIDAYS_ITEMS_FOR_CHANGEOVER);\n    },\n  );\n\n  router.post(paths.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS_NOT_REQUIRED, (request, response) => {\n    const handoverAndHolidays = getSessionValue<any>(request.session, 'handoverAndHolidays') || {};\n    delete handoverAndHolidays.howChangeDuringSchoolHolidays;\n    setSessionSection(request.session, 'handoverAndHolidays', {\n      ...handoverAndHolidays,\n      willChangeDuringSchoolHolidays: {\n        noDecisionRequired: true,\n      },\n    });\n\n    addCompletedStep(request, FORM_STEPS.HANDOVER_HOLIDAYS_WILL_CHANGE_DURING_SCHOOL_HOLIDAYS);\n\n    return response.redirect(paths.HANDOVER_HOLIDAYS_ITEMS_FOR_CHANGEOVER);\n  });\n};\n\nexport default willChangeDuringSchoolHolidaysRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,+BAAoD;AAGpD,wBAAuB;AACvB,uBAAuB;AACvB,mBAAkB;AAClB,yCAAwC;AACxC,8BAA6B;AAC7B,4BAAsD;AACtD,6BAAmD;AACnD,4BAA2B;AAE3B,MAAM,uCAAuC,CAAC,WAAmB;AAC/D,SAAO,IAAI,aAAAA,QAAM,0DAAsD,mCAAAC,SAA4B,iBAAAC,QAAW,oDAAoD,GAAG,CAAC,SAAS,aAAa;AAC1L,UAAM,0BAAsB,wCAAqB,QAAQ,SAAS,qBAAqB;AAEvF,aAAS,OAAO,4DAA4D;AAAA,MAC1E,QAAQ,QAAQ,MAAM,QAAQ;AAAA,MAC9B,OAAO,QAAQ,GAAG,0DAA0D;AAAA,MAC5E,kBAAc,kCAAW,QAAQ,SAAS,aAAAF,QAAM,gCAAgC;AAAA,MAChF,YAAY;AAAA,QACV,CAAC,kBAAAG,QAAW,kCAAkC,OAAG;AAAA,UAC/C,qBAAqB,gCAAgC;AAAA,QACvD;AAAA,MACF;AAAA,IACF,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL,aAAAH,QAAM;AAAA,QACN,+BAAK,kBAAAG,QAAW,kCAAkC,EAC/C,OAAO,EACP,YAAY,CAAC,QAAQ,EAAE,IAAI,MAAM,IAAI,GAAG,0DAA0D,CAAC;AAAA,IACtG,CAAC,SAAS,aAAa;AACrB,YAAM,aAAS,2CAAiB,OAAO;AAEvC,UAAI,CAAC,OAAO,QAAQ,GAAG;AACrB,gBAAQ,MAAM,UAAU,OAAO,MAAM,CAAC;AACtC,eAAO,SAAS,SAAS,aAAAH,QAAM,oDAAoD;AAAA,MACrF;AAEA,YAAM,eAAW,sCAEd,OAAO;AAEV,YAAM,yBAAyB,SAAS,kBAAAG,QAAW,kCAAkC,MAAM;AAE3F,YAAM,0BAAsB,wCAAqB,QAAQ,SAAS,qBAAqB,KAAK,CAAC;AAC7F,oDAAkB,QAAQ,SAAS,uBAAuB;AAAA,QACxD,GAAG;AAAA,QACH,gCAAgC;AAAA,UAC9B,oBAAoB;AAAA,UACpB,YAAY;AAAA,QACd;AAAA,MACF,CAAC;AAED,UAAI,wBAAwB;AAC1B,oCAAAC,SAAiB,SAAS,iBAAAF,QAAW,oDAAoD;AACzF,eAAO,SAAS,SAAS,aAAAF,QAAM,mDAAmD;AAAA,MACpF;AAEA,YAAM,iCAA6B,wCAAqB,QAAQ,SAAS,qBAAqB,KAAK,CAAC;AACpG,aAAO,2BAA2B;AAClC,oDAAkB,QAAQ,SAAS,uBAAuB,0BAA0B;AAEpF,kCAAAI,SAAiB,SAAS,iBAAAF,QAAW,oDAAoD;AAEzF,aAAO,SAAS,SAAS,aAAAF,QAAM,sCAAsC;AAAA,IACvE;AAAA,EACF;AAEA,SAAO,KAAK,aAAAA,QAAM,mEAAmE,CAAC,SAAS,aAAa;AAC1G,UAAM,0BAAsB,wCAAqB,QAAQ,SAAS,qBAAqB,KAAK,CAAC;AAC7F,WAAO,oBAAoB;AAC3B,kDAAkB,QAAQ,SAAS,uBAAuB;AAAA,MACxD,GAAG;AAAA,MACH,gCAAgC;AAAA,QAC9B,oBAAoB;AAAA,MACtB;AAAA,IACF,CAAC;AAED,gCAAAI,SAAiB,SAAS,iBAAAF,QAAW,oDAAoD;AAEzF,WAAO,SAAS,SAAS,aAAAF,QAAM,sCAAsC;AAAA,EACvE,CAAC;AACH;AAEA,IAAO,yCAAQ;",
  "names": ["paths", "checkFormProgressFromConfig", "FORM_STEPS", "formFields", "addCompletedStep"]
}
