{
  "version": 3,
  "sources": ["../../../server/routes/otherThings/whatOtherThingsMatter.ts"],
  "sourcesContent": ["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { Router } from 'express';\nimport { body, matchedData, validationResult } from 'express-validator';\n\nimport formFields from '../../constants/formFields';\nimport FORM_STEPS from '../../constants/formSteps';\nimport paths from '../../constants/paths';\nimport checkFormProgressFromConfig  from '../../middleware/checkFormProgressFromConfig';\nimport addCompletedStep from '../../utils/addCompletedStep';\nimport { getSessionValue, setSessionSection } from '../../utils/perChildSession';\nimport { getBackUrl, getRedirectUrlAfterFormSubmit } from '../../utils/sessionHelpers';\n\nconst whatOtherThingsMatterRoutes = (router: Router) => {\n  router.get(paths.OTHER_THINGS_WHAT_OTHER_THINGS_MATTER, checkFormProgressFromConfig(FORM_STEPS.OTHER_THINGS_WHAT_OTHER_THINGS_MATTER), (request, response) => {\n    const otherThings = getSessionValue<any>(request.session, 'otherThings');\n\n    response.render('pages/otherThings/whatOtherThingsMatter', {\n      errors: request.flash('errors'),\n      title: request.__('otherThings.whatOtherThingsMatter.title'),\n      initialWhatOtherThingsMatter: otherThings?.whatOtherThingsMatter?.answer,\n      backLinkHref: getBackUrl(request.session, paths.TASK_LIST),\n    });\n  });\n\n  router.post(\n    paths.OTHER_THINGS_WHAT_OTHER_THINGS_MATTER,\n    body(formFields.WHAT_OTHER_THINGS_MATTER)\n      .trim()\n      .notEmpty()\n      .withMessage((_value, { req }) => req.__('otherThings.whatOtherThingsMatter.error')),\n    (request, response) => {\n      const errors = validationResult(request);\n\n      if (!errors.isEmpty()) {\n        request.flash('errors', errors.array());\n        return response.redirect(paths.OTHER_THINGS_WHAT_OTHER_THINGS_MATTER);\n      }\n\n      const { [formFields.WHAT_OTHER_THINGS_MATTER]: whatOtherThingsMatter } = matchedData<{\n        [formFields.WHAT_OTHER_THINGS_MATTER]: string;\n      }>(request, { onlyValidData: false });\n\n      const otherThings = getSessionValue<any>(request.session, 'otherThings') || {};\n      setSessionSection(request.session, 'otherThings', {\n        ...otherThings,\n        whatOtherThingsMatter: {\n          noDecisionRequired: false,\n          answer: whatOtherThingsMatter,\n        },\n      });\n\n      addCompletedStep(request, FORM_STEPS.OTHER_THINGS_WHAT_OTHER_THINGS_MATTER);\n      \n      return response.redirect(getRedirectUrlAfterFormSubmit(request.session, paths.TASK_LIST));\n    },\n  );\n\n  router.post(paths.OTHER_THINGS_WHAT_OTHER_THINGS_MATTER_NOT_REQUIRED, (request, response) => {\n    const otherThings = getSessionValue<any>(request.session, 'otherThings') || {};\n    setSessionSection(request.session, 'otherThings', {\n      ...otherThings,\n      whatOtherThingsMatter: {\n        noDecisionRequired: true,\n      },\n    });\n\n    addCompletedStep(request, FORM_STEPS.OTHER_THINGS_WHAT_OTHER_THINGS_MATTER);\n\n    return response.redirect(getRedirectUrlAfterFormSubmit(request.session, paths.TASK_LIST));\n  });\n};\n\nexport default whatOtherThingsMatterRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,+BAAoD;AAEpD,wBAAuB;AACvB,uBAAuB;AACvB,mBAAkB;AAClB,yCAAyC;AACzC,8BAA6B;AAC7B,6BAAmD;AACnD,4BAA0D;AAE1D,MAAM,8BAA8B,CAAC,WAAmB;AACtD,SAAO,IAAI,aAAAA,QAAM,2CAAuC,mCAAAC,SAA4B,iBAAAC,QAAW,qCAAqC,GAAG,CAAC,SAAS,aAAa;AAC5J,UAAM,kBAAc,wCAAqB,QAAQ,SAAS,aAAa;AAEvE,aAAS,OAAO,2CAA2C;AAAA,MACzD,QAAQ,QAAQ,MAAM,QAAQ;AAAA,MAC9B,OAAO,QAAQ,GAAG,yCAAyC;AAAA,MAC3D,8BAA8B,aAAa,uBAAuB;AAAA,MAClE,kBAAc,kCAAW,QAAQ,SAAS,aAAAF,QAAM,SAAS;AAAA,IAC3D,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL,aAAAA,QAAM;AAAA,QACN,+BAAK,kBAAAG,QAAW,wBAAwB,EACrC,KAAK,EACL,SAAS,EACT,YAAY,CAAC,QAAQ,EAAE,IAAI,MAAM,IAAI,GAAG,yCAAyC,CAAC;AAAA,IACrF,CAAC,SAAS,aAAa;AACrB,YAAM,aAAS,2CAAiB,OAAO;AAEvC,UAAI,CAAC,OAAO,QAAQ,GAAG;AACrB,gBAAQ,MAAM,UAAU,OAAO,MAAM,CAAC;AACtC,eAAO,SAAS,SAAS,aAAAH,QAAM,qCAAqC;AAAA,MACtE;AAEA,YAAM,EAAE,CAAC,kBAAAG,QAAW,wBAAwB,GAAG,sBAAsB,QAAI,sCAEtE,SAAS,EAAE,eAAe,MAAM,CAAC;AAEpC,YAAM,kBAAc,wCAAqB,QAAQ,SAAS,aAAa,KAAK,CAAC;AAC7E,oDAAkB,QAAQ,SAAS,eAAe;AAAA,QAChD,GAAG;AAAA,QACH,uBAAuB;AAAA,UACrB,oBAAoB;AAAA,UACpB,QAAQ;AAAA,QACV;AAAA,MACF,CAAC;AAED,kCAAAC,SAAiB,SAAS,iBAAAF,QAAW,qCAAqC;AAE1E,aAAO,SAAS,aAAS,qDAA8B,QAAQ,SAAS,aAAAF,QAAM,SAAS,CAAC;AAAA,IAC1F;AAAA,EACF;AAEA,SAAO,KAAK,aAAAA,QAAM,oDAAoD,CAAC,SAAS,aAAa;AAC3F,UAAM,kBAAc,wCAAqB,QAAQ,SAAS,aAAa,KAAK,CAAC;AAC7E,kDAAkB,QAAQ,SAAS,eAAe;AAAA,MAChD,GAAG;AAAA,MACH,uBAAuB;AAAA,QACrB,oBAAoB;AAAA,MACtB;AAAA,IACF,CAAC;AAED,gCAAAI,SAAiB,SAAS,iBAAAF,QAAW,qCAAqC;AAE1E,WAAO,SAAS,aAAS,qDAA8B,QAAQ,SAAS,aAAAF,QAAM,SAAS,CAAC;AAAA,EAC1F,CAAC;AACH;AAEA,IAAO,gCAAQ;",
  "names": ["paths", "checkFormProgressFromConfig", "FORM_STEPS", "formFields", "addCompletedStep"]
}
