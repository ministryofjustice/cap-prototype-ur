{
  "version": 3,
  "sources": ["../../server/routes/childrenSafetyCheck.ts"],
  "sourcesContent": ["import { Router } from 'express';\nimport { body, matchedData, validationResult } from 'express-validator';\n\nimport { yesOrNo } from '../@types/fields';\nimport formFields from '../constants/formFields';\nimport FORM_STEPS from '../constants/formSteps';\nimport paths from '../constants/paths';\nimport checkFormProgressFromConfig  from '../middleware/checkFormProgressFromConfig';\nimport addCompletedStep from '../utils/addCompletedStep';\nimport { getBackUrl } from '../utils/sessionHelpers';\n\nconst safetyCheckRoutes = (router: Router) => {\n  router.get(paths.CHILDREN_SAFETY_CHECK, checkFormProgressFromConfig(FORM_STEPS.CHILDREN_SAFETY_CHECK), (request, response) => {\n    response.render('pages/childrenSafetyCheck', {\n      errors: request.flash('errors'),\n      title: request.__('childrenSafetyCheck.title'),\n      backLinkHref: getBackUrl(request.session, paths.SAFETY_CHECK),\n    });\n  });\n\n  router.get(paths.CHILDREN_NOT_SAFE, checkFormProgressFromConfig(FORM_STEPS.CHILDREN_NOT_SAFE), (request, response) => {\n    addCompletedStep(request, FORM_STEPS.CHILDREN_NOT_SAFE);\n    response.render('pages/childrenNotSafe', {\n      title: request.__('childrenNotSafe.title'),\n      backLinkHref: paths.CHILDREN_SAFETY_CHECK,\n    });\n  });\n\n  router.post(\n    paths.CHILDREN_SAFETY_CHECK,\n    body(formFields.CHILDREN_SAFETY_CHECK)\n      .exists()\n      .withMessage((_value, { req }) => req.__('childrenSafetyCheck.error')),\n    (request, response) => {\n      const errors = validationResult(request);\n      if (!errors.isEmpty()) {\n        request.flash('errors', errors.array());\n        return response.redirect(paths.CHILDREN_SAFETY_CHECK);\n      }\n\n      const { [formFields.CHILDREN_SAFETY_CHECK]: isSafe } = matchedData<{\n        [formFields.CHILDREN_SAFETY_CHECK]: yesOrNo;\n      }>(request);\n\n      addCompletedStep(request, FORM_STEPS.CHILDREN_SAFETY_CHECK);\n      return isSafe === 'Yes' ? response.redirect(paths.DO_WHATS_BEST) : response.redirect(paths.CHILDREN_NOT_SAFE);\n    },\n  );\n};\n\nexport default safetyCheckRoutes;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,+BAAoD;AAGpD,wBAAuB;AACvB,uBAAuB;AACvB,mBAAkB;AAClB,yCAAyC;AACzC,8BAA6B;AAC7B,4BAA2B;AAE3B,MAAM,oBAAoB,CAAC,WAAmB;AAC5C,SAAO,IAAI,aAAAA,QAAM,2BAAuB,mCAAAC,SAA4B,iBAAAC,QAAW,qBAAqB,GAAG,CAAC,SAAS,aAAa;AAC5H,aAAS,OAAO,6BAA6B;AAAA,MAC3C,QAAQ,QAAQ,MAAM,QAAQ;AAAA,MAC9B,OAAO,QAAQ,GAAG,2BAA2B;AAAA,MAC7C,kBAAc,kCAAW,QAAQ,SAAS,aAAAF,QAAM,YAAY;AAAA,IAC9D,CAAC;AAAA,EACH,CAAC;AAED,SAAO,IAAI,aAAAA,QAAM,uBAAmB,mCAAAC,SAA4B,iBAAAC,QAAW,iBAAiB,GAAG,CAAC,SAAS,aAAa;AACpH,gCAAAC,SAAiB,SAAS,iBAAAD,QAAW,iBAAiB;AACtD,aAAS,OAAO,yBAAyB;AAAA,MACvC,OAAO,QAAQ,GAAG,uBAAuB;AAAA,MACzC,cAAc,aAAAF,QAAM;AAAA,IACtB,CAAC;AAAA,EACH,CAAC;AAED,SAAO;AAAA,IACL,aAAAA,QAAM;AAAA,QACN,+BAAK,kBAAAI,QAAW,qBAAqB,EAClC,OAAO,EACP,YAAY,CAAC,QAAQ,EAAE,IAAI,MAAM,IAAI,GAAG,2BAA2B,CAAC;AAAA,IACvE,CAAC,SAAS,aAAa;AACrB,YAAM,aAAS,2CAAiB,OAAO;AACvC,UAAI,CAAC,OAAO,QAAQ,GAAG;AACrB,gBAAQ,MAAM,UAAU,OAAO,MAAM,CAAC;AACtC,eAAO,SAAS,SAAS,aAAAJ,QAAM,qBAAqB;AAAA,MACtD;AAEA,YAAM,EAAE,CAAC,kBAAAI,QAAW,qBAAqB,GAAG,OAAO,QAAI,sCAEpD,OAAO;AAEV,kCAAAD,SAAiB,SAAS,iBAAAD,QAAW,qBAAqB;AAC1D,aAAO,WAAW,QAAQ,SAAS,SAAS,aAAAF,QAAM,aAAa,IAAI,SAAS,SAAS,aAAAA,QAAM,iBAAiB;AAAA,IAC9G;AAAA,EACF;AACF;AAEA,IAAO,8BAAQ;",
  "names": ["paths", "checkFormProgressFromConfig", "FORM_STEPS", "addCompletedStep", "formFields"]
}
